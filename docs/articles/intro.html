<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to <code>hesim</code> • hesim</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction to &lt;code&gt;hesim&lt;/code&gt;">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hesim</a>
        <span class="label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased package">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">API</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/psm.html">Partitioned survival models</a>
    </li>
    <li>
      <a href="../articles/icea.html">Individualized cost-effectiveness analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/InnovationValueInitiative/hesim">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to <code>hesim</code>
</h1>
            
            <h4 class="date">2018-10-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/InnovationValueInitiative/hesim/blob/master/vignettes/intro.Rmd"><code>vignettes/intro.Rmd</code></a></small>
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p><code>hesim</code> is an R package that integrates statistical modeling, economic modeling, and decision analysis for the economic evaluation of health technologies. Economic evaluation proceeds in a three-step process as shown in the figure (adapted from <a href="https://egon.stats.ucl.ac.uk/projects/BCEAweb/">BCEAweb</a>) below .</p>
<p><br><img src="econ-eval-process.png" width="600px"><br><br></p>
<p>First, a statistical model (or statistical models) are fit to estimate parameters. Second, the parameters are combined to construct an economic model, which, in turn, is used to simulate measures of clinical benefits (e.g., quality-adjusted life-years (QALYs)) and costs. Third, the economic value of a medical technology is evaluated by summarizing clinical benefits and costs. The entire analysis is inherently Bayesian, as uncertainty in the parameters from the statistical models is propagated throughout the economic model and decision analysis with probabilistic sensitivity analysis (PSA). Furthermore, since the statistical and economic models are integrated, patient heterogeneity can be easily introduced with patient level covariates.</p>
<p><code>hesim</code> focuses on <strong>step 2</strong> (economic modeling) but is naturally integrated with step 1 (statistical modeling) and provides support for step 3 (decision analysis). As shown in the figure below, a typical analysis would proceed as follows:</p>
<ol style="list-style-type: decimal">
<li>The parameters of a statistical model are estimated using an “estimation” dataset, such as extracted data from published studies for a meta-analysis or multi-state survival data from a clinical trial. Parameters are estimated for disease progression, utility, and costs. Each statistical model is constructed by combining the parameter estimates with information on the treatment strategies, patients, and/or health states of interest for the economic model.</li>
<li>The disease progression, utility, and cost models are combined into a coherent economic model to simulate outcomes of interest such as disease progression, QALYs, and costs.</li>
<li>Relevant outcomes from step 2 are used to perform decision analysis using approaches such as <a href="https://en.wikipedia.org/wiki/Cost-effectiveness_analysis">cost-effectiveness analysis (CEA)</a> and <a href="https://en.wikipedia.org/wiki/Multiple-criteria_decision_analysis">multi-criteria decision analysis (MCDA)</a>.</li>
</ol>
<p><br><img src="econ-eval-process-hesim.png" width="800px"><br><br></p>
<p><code>hesim</code> supports both cohort-level and individual-level economic models. The cohort-level models simulate disease progression for representative cohorts of patients with similar characteristics while the individual-level models simulate individual patients probabilistically using random number generation. Economic models currently supported include:</p>
<ul>
<li>N-state partitioned survival models (PSMs)</li>
<li>Individual-level continuous time state transition models (CTSTMs)</li>
</ul>
<p>The package is under active development and new features are being added. We expect to release a stable version of the package in the beginning of January and to add cohort-level CTSTMs and cohort-level discrete time state transition models (DTSTMs).</p>
</div>
<div id="statistical-models" class="section level2">
<h2 class="hasAnchor">
<a href="#statistical-models" class="anchor"></a>Statistical models</h2>
<p>The statistical models in <code>hesim</code> are characterized by a distribution over outcomes, <span class="math inline">\(y\)</span>, which depend on model parameters, <span class="math inline">\(\alpha_1, \ldots, \alpha_L\)</span>,</p>
<p><span class="math display">\[
\begin{aligned}
P(y| \alpha_1(x_1), \ldots, \alpha_L(x_L)).
\end{aligned}
\]</span> The <span class="math inline">\(l\)</span>th model parameter can depend on a vector of coefficients, <span class="math inline">\(\beta_l\)</span>, and an input vector, <span class="math inline">\(x_l\)</span>, of covariates through linked transformed linear models <span class="math inline">\(g(\alpha_l(x_l)) = x_l^T \beta_l\)</span>. The outcomes, <span class="math inline">\(y\)</span>, can be predicted using the mean of the distribution, <span class="math inline">\(E(y|\cdot)\)</span>, or sampled with a random draw from the probability distribution, <span class="math inline">\(P(y|\cdot)\)</span>.</p>
<div id="parameter-estimates" class="section level3">
<h3 class="hasAnchor">
<a href="#parameter-estimates" class="anchor"></a>Parameter estimates</h3>
<p>In <code>hesim</code>, the estimated coefficients for each parameter are generally stored in matrices (or a single matrix if the model only has one parameter), where the columns of each matrix are covariates and the rows are random samples from a relevant probability distribution (i.e. the posterior distribution in a Bayesian model). Parameters are stored in objects prefixed by <code>params_</code> (e.g., <code>params_surv</code> for a survival model, <code>params_lm</code> for a linear model). A <code>params_</code> prefixed object can be created in one of two ways:</p>
<ol style="list-style-type: decimal">
<li>With a function of the same name such as <code><a href="../reference/params_surv.html">params_surv()</a></code> or <code><a href="../reference/params_lm.html">params_lm()</a></code>
</li>
<li>By using the generic function <code><a href="../reference/create_params.html">create_params()</a></code> to create objects from fitted statistical models</li>
</ol>
<p>This flexibility is provided so that parameters can either be estimated using models fit with <code>R</code> or from an external source. Here we illustrate the second method by fitting a 3 state (4 transition) Weibull multi-state model using <code><a href="http://www.rdocumentation.org/packages/flexsurv/topics/flexsurvreg">flexsurvreg()</a></code> from the <a href="https://cran.r-project.org/web/packages/flexsurv/index.html">flexsurv</a> package. We randomly draw 3 samples of the coefficients for the shape and scale parameters from a multivariate normal distribution that approximates the Bayesian posterior distribution and store them in a <code>params_surv</code> object (note that <code>hesim</code> accepts Weibull distributions by the name “weibull” or “weibull.quiet”).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"hesim"</span>)
<span class="kw">library</span>(<span class="st">"flexsurv"</span>)
<span class="kw">library</span>(<span class="st">"data.table"</span>)

n_samples &lt;-<span class="st"> </span><span class="dv">3</span> 
mstate_data &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(hesim<span class="op">::</span>ctstm3_exdata<span class="op">$</span>transitions)
mstate_data[, trans <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(trans)]
fit_wei &lt;-<span class="st"> </span>flexsurv<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/flexsurv/topics/flexsurvreg">flexsurvreg</a></span>(<span class="kw">Surv</span>(years, status) <span class="op">~</span><span class="st"> </span><span class="kw">factor</span>(strategy_id)<span class="op">*</span>trans <span class="op">+</span>
<span class="st">                                                    </span><span class="kw">shape</span>(trans), 
                                                    <span class="dt">data =</span> mstate_data, 
                                                    <span class="dt">dist =</span> <span class="st">"weibull"</span>)
params_wei &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_params.html">create_params</a></span>(fit_wei, <span class="dt">n =</span> n_samples)
<span class="kw">print</span>(params_wei)</code></pre></div>
<pre><code>## $coefs
## $coefs$shape
##           shape shape(trans2) shape(trans3) shape(trans4)
## [1,] -0.2981318    0.21634562     0.3326618  -0.003180183
## [2,] -0.2618417    0.09772622     0.2945335  -0.071728351
## [3,] -0.3021900    0.17222356     0.3865460   0.028857401
## 
## $coefs$scale
##         scale factor(strategy_id)2    trans2     trans3      trans4
## [1,] 1.286250            0.4182135 1.3056487 -0.6847185 -0.14385712
## [2,] 1.362507            0.2971626 1.4484461 -0.8254492  0.06281405
## [3,] 1.535374            0.2782085 0.9924034 -1.0435452 -0.28365820
##      factor(strategy_id)2:trans2 factor(strategy_id)2:trans3
## [1,]                  -0.2442806                  -0.5614953
## [2,]                  -0.5065691                  -0.4951938
## [3,]                  -0.1443417                  -0.5677017
##      factor(strategy_id)2:trans4
## [1,]                  -0.2190645
## [2,]                  -0.6900635
## [3,]                  -0.5223254
## 
## 
## $dist
## [1] "weibull.quiet"
## 
## $n_samples
## [1] 3
## 
## attr(,"class")
## [1] "params_surv"</code></pre>
</div>
<div id="input-data" class="section level3">
<h3 class="hasAnchor">
<a href="#input-data" class="anchor"></a>Input data</h3>
<p>The input vectors for each parameter, <span class="math inline">\(x_{l,hijk}\)</span>, are rows in multidimensional input matrices, <span class="math inline">\(X_l\)</span>, where each row denotes a unique observation. The input matrix for parameter <span class="math inline">\(l\)</span> is indexed by health-related indices <span class="math inline">\(h\)</span> and patients <span class="math inline">\(i\)</span> for a treatment strategy <span class="math inline">\(k\)</span>. Example health-related indices include a health state, a transition between two health states, or a survival endpoint in a partitioned survival model (PSM). In some cases, the health-related index <span class="math inline">\(h\)</span> can be suppressed and separate models can be fit for each health index. This is, for instance, the case in a PSM where separate models are fit for each survival endpoint.</p>
<p>The data and variables needed for the statistical models are stored in objects of class “expanded_hesim_data”, which are <a href="https://github.com/Rdatatable/data.table/wiki">data tables</a> or data frames in long format that contain (i) treatment strategy, patient, and/or health-related ID variables indexing each row, and (ii) the covariates for the statistical model. The names of the ID variables are attributes of the data table.</p>
<p>An “expanded_hesim_data” object can be created directly or by expanding an object of class “hesim_data”, which contains relevant data for the economic model. For instance, suppose we would like to create a dataset for modeling transitions between 3 health states for 2 treatment strategies and 2 representative patients. We first use <code><a href="../reference/hesim_data.html">hesim_data()</a></code> to store the data for each treatment strategy, representative patient, and transition.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">strategies &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(<span class="dt">strategy_id =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
patients &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(<span class="dt">patient_id =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">2</span>),
                          <span class="dt">age =</span> <span class="kw">c</span>(<span class="dv">45</span>, <span class="dv">50</span>),
                          <span class="dt">female =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))
tmat &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/data.table/topics/rbindlist">rbind</a></span>(<span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>),
              <span class="kw">c</span>(<span class="dv">3</span>, <span class="ot">NA</span>, <span class="dv">4</span>),
              <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>))
<span class="kw">colnames</span>(tmat) &lt;-<span class="st"> </span><span class="kw">rownames</span>(tmat) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Healthy"</span>, <span class="st">"Sick"</span>, <span class="st">"Dead"</span>)
transitions &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_trans_dt.html">create_trans_dt</a></span>(tmat)
transitions[, trans <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">factor</span>(transition_id)]
hesim_dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hesim_data.html">hesim_data</a></span>(<span class="dt">strategies =</span> strategies,
                        <span class="dt">patients =</span> patients,
                        <span class="dt">transitions =</span> transitions)
<span class="kw">print</span>(hesim_dat)</code></pre></div>
<pre><code>## $strategies
##    strategy_id
## 1:           1
## 2:           2
## 
## $patients
##    patient_id age female
## 1:          1  45      0
## 2:          2  50      1
## 
## $transitions
##    transition_id from to from_name to_name trans
## 1:             1    1  2   Healthy    Sick     1
## 2:             2    1  3   Healthy    Dead     2
## 3:             3    2  1      Sick Healthy     3
## 4:             4    2  3      Sick    Dead     4
## 
## attr(,"class")
## [1] "hesim_data"</code></pre>
<p>Then we use <code><a href="../reference/expand.html">expand()</a></code> to create a dataset in long format where there is one row for each treatment strategy, patient, and transition.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">transmod_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expand.html">expand</a></span>(hesim_dat, 
                        <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"strategies"</span>, <span class="st">"patients"</span>, <span class="st">"transitions"</span>))
transmod_data[<span class="dv">1</span><span class="op">:</span><span class="dv">16</span>]</code></pre></div>
<pre><code>##     strategy_id patient_id transition_id age female from to from_name
##  1:           1          1             1  45      0    1  2   Healthy
##  2:           1          1             2  45      0    1  3   Healthy
##  3:           1          1             3  45      0    2  1      Sick
##  4:           1          1             4  45      0    2  3      Sick
##  5:           1          2             1  50      1    1  2   Healthy
##  6:           1          2             2  50      1    1  3   Healthy
##  7:           1          2             3  50      1    2  1      Sick
##  8:           1          2             4  50      1    2  3      Sick
##  9:           2          1             1  45      0    1  2   Healthy
## 10:           2          1             2  45      0    1  3   Healthy
## 11:           2          1             3  45      0    2  1      Sick
## 12:           2          1             4  45      0    2  3      Sick
## 13:           2          2             1  50      1    1  2   Healthy
## 14:           2          2             2  50      1    1  3   Healthy
## 15:           2          2             3  50      1    2  1      Sick
## 16:           2          2             4  50      1    2  3      Sick
##     to_name trans
##  1:    Sick     1
##  2:    Dead     2
##  3: Healthy     3
##  4:    Dead     4
##  5:    Sick     1
##  6:    Dead     2
##  7: Healthy     3
##  8:    Dead     4
##  9:    Sick     1
## 10:    Dead     2
## 11: Healthy     3
## 12:    Dead     4
## 13:    Sick     1
## 14:    Dead     2
## 15: Healthy     3
## 16:    Dead     4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># These are the ID variables</span>
<span class="kw">attributes</span>(transmod_data)<span class="op">$</span>id_vars</code></pre></div>
<pre><code>## [1] "strategy_id"   "patient_id"    "transition_id"</code></pre>
</div>
<div id="creating-a-statistical-model" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-a-statistical-model" class="anchor"></a>Creating a statistical model</h3>
<p>A statistical model is instantiated by combining the parameter estimates and input data. A statistical model can be created from an “expanded_hesim_data” object and either a parameter object (prefixed by <code>params_</code>) or a fitted statistical model using functions prefixed by <code>create_</code>. For example, we can create a model of health state transitions for an individual-level CTSTM using <code><a href="../reference/create_IndivCtstmTrans.html">create_IndivCtstmTrans()</a></code> from the <code>fit_wei</code> object above, which is a fitted Weibull multi-state model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">transmod &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_IndivCtstmTrans.html">create_IndivCtstmTrans</a></span>(fit_wei, transmod_data,
                                   <span class="dt">trans_mat =</span> tmat, <span class="dt">n =</span> <span class="dv">100</span>)
<span class="kw">class</span>(transmod)</code></pre></div>
<pre><code>## [1] "IndivCtstmTrans" "CtstmTrans"      "R6"</code></pre>
</div>
</div>
<div id="economic-model" class="section level2">
<h2 class="hasAnchor">
<a href="#economic-model" class="anchor"></a>Economic model</h2>
<p>An economic model for an individual-level CTSTM would be constructed by combining the <code>transmod</code> object with statistical models for costs and utility. Examples analyses are currently available for <a href="psm.html">PSMs</a> and <a href="https://innovationvalueinitiative.github.io/modern-software-HTA/example.html">individual-level CTSTMs</a>.</p>
</div>
<div id="decision-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#decision-analysis" class="anchor"></a>Decision analysis</h2>
<p>Once output has been simulated with an economic model, a CEA or MCDA can be performed. <code>hesim</code> (<a href="icea.html">here</a>) provides support for CEA including summarizing a PSA and individualized cost-effectiveness analysis. Output from <code>hesim</code> economic models can also be easily analyzed using other R packages such as <a href="https://sites.google.com/a/statistica.it/gianluca/bcea">bcea</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#statistical-models">Statistical models</a></li>
      <li><a href="#economic-model">Economic model</a></li>
      <li><a href="#decision-analysis">Decision analysis</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
