<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discrete time state transition model for HIV treatment • hesim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Discrete time state transition model for HIV treatment">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hesim</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.2.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">API</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/dtstm.html">Discrete time state transition models</a>
    </li>
    <li>
      <a href="../articles/psm.html">Partitioned survival models</a>
    </li>
    <li>
      <a href="../articles/ctstm.html">Continuous time state transition models</a>
    </li>
    <li>
      <a href="../articles/icea.html">Individualized cost-effectiveness analysis</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Examples</li>
    <li>
      <a href="../articles/dtstm-hiv.html">Discrete time state transition model for HIV</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hesim-dev/hesim">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Discrete time state transition model for HIV treatment</h1>
            
            <h4 class="date">2019-10-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hesim-dev/hesim/blob/master/vignettes/dtstm-hiv.Rmd"><code>vignettes/dtstm-hiv.Rmd</code></a></small>
      <div class="hidden name"><code>dtstm-hiv.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a><span class="header-section-number">1</span> Overview</h1>
<p>This example analysis replicates the HIV model developed by <a href="https://link.springer.com/article/10.2165/00019053-199712010-00006">Chancellor et al.</a> and used for didactic purposes in the <a href="https://www.herc.ox.ac.uk/downloads/decision-modelling-for-health-economic-evaluation"><em>Decision Modeling for Health Economic Evaluation</em></a> textbook. In doing so, we show how <a href="https://mc-stan.org/">Stan</a>, a probabilistic programming language for Bayesian inference, can be integrated with <code>hesim</code>.</p>
<p>The analysis compares two treatment strategies, zidovudine montherapy and zidovudine + lamivudine combination therapy. Patients are assumed to only use lamivudine for 2 years before switching back to monotherapy.</p>
<p>The model is a cohort discrete time state transition model (DTSTM) (i.e., a Markov model) with 4 health states. Ordered from worst to best to worst, they are: State A (CD4 cells &gt; 200 and &lt; 500 cells/mm3), State B (CD4 &lt; 200 cells/mm3), State C (AIDS), and State D (death). The model assumes that patients can transition to any state that is more severe (i.e., progress) but cannot transition back to a more severe state.</p>
<p><img src="dtstm-hiv.png" width="700px"></p>
<p>We set up the model by specifying the treatment strategies and the (non-death) health states. The model is simulated for 1 representative patient.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"hesim"</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"data.table"</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>strategies &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(<span class="dt">strategy_id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,</span>
<span id="cb1-4"><a href="#cb1-4"></a>                         <span class="dt">strategy_name =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Monotherapy"</span>, <span class="st">"Combination therapy"</span>))</span>
<span id="cb1-5"><a href="#cb1-5"></a>patients &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(<span class="dt">patient_id =</span> <span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a>states &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(<span class="dt">state_id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</span>
<span id="cb1-7"><a href="#cb1-7"></a>                     <span class="dt">state_name =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>)) <span class="co"># Non-death health states</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>hesim_dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hesim_data.html">hesim_data</a></span>(<span class="dt">strategies =</span> strategies,</span>
<span id="cb1-9"><a href="#cb1-9"></a>                        <span class="dt">patients =</span> patients, </span>
<span id="cb1-10"><a href="#cb1-10"></a>                        <span class="dt">states =</span> states)</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(hesim_dat)</span></code></pre></div>
<pre><code>## $strategies
##    strategy_id       strategy_name
## 1:           1         Monotherapy
## 2:           2 Combination therapy
## 
## $patients
##    patient_id
## 1:          1
## 
## $states
##    state_id state_name
## 1:        1          A
## 2:        2          B
## 3:        3          C
## 
## attr(,"class")
## [1] "hesim_data"</code></pre>
</div>
<div id="parameter-estimation" class="section level1">
<h1 class="hasAnchor">
<a href="#parameter-estimation" class="anchor"></a><span class="header-section-number">2</span> Parameter estimation</h1>
<p>Since we will estimate the parameters in a Bayesian fashion to facilitate a probabilistic sensitivity analysis (PSA), we specify the number of parameter samples.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>n_samples &lt;-<span class="st"> </span><span class="dv">1000</span></span></code></pre></div>
<div id="transition-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#transition-probabilities" class="anchor"></a><span class="header-section-number">2.1</span> Transition probabilities</h2>
<p>Counts of transitions at yearly intervals between each of the 4 health states were available from a longitudinal dataset from Chelsea and Westminister hospital.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>trans_mono &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1251</span>, <span class="dv">350</span>, <span class="dv">116</span>, <span class="dv">17</span>,</span>
<span id="cb4-2"><a href="#cb4-2"></a>                       <span class="dv">0</span>, <span class="dv">731</span>, <span class="dv">512</span>, <span class="dv">15</span>,</span>
<span id="cb4-3"><a href="#cb4-3"></a>                       <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1312</span>, <span class="dv">437</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>                       <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">469</span>),</span>
<span id="cb4-5"><a href="#cb4-5"></a>                      <span class="dt">ncol =</span> <span class="dv">4</span>, <span class="dt">nrow =</span> <span class="dv">4</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(trans_mono) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(trans_mono) &lt;-<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>)</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(trans_mono)</span></code></pre></div>
<pre><code>##      A   B    C   D
## A 1251 350  116  17
## B    0 731  512  15
## C    0   0 1312 437
## D    0   0    0 469</code></pre>
<p>The transition probabilities from state <span class="math inline">\(r\)</span> to each of the 4 states (State A, State B, State C, and State D) can be modeled using Dirichlet distributions, which are parameterized by a vector of concentration parameters <span class="math inline">\(\alpha = (\alpha_{r1}, \alpha_{r2}, \alpha_{r3}, \alpha_{r4})\)</span>. The Dirichlet distribution is particularly useful for modeling uncertainty in the transition probabilities because it is a conjugate prior for the multinomial distribution. The posterior distribution of <span class="math inline">\(\alpha\)</span> consequently follows a Dirichlet distribution which can be thought of as the “effective sample size” for each transition (see Appendix).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>alpha_mono &lt;-<span class="st"> </span>trans_mono</span></code></pre></div>
<p>Treatment effects are defined in terms of the relative risk, which is assumed to reduce the probability of all transitions to a more severe health state by an equal amount. We work with the log relative risk since it is approximately normally distributed. The estimated relative risk of disease progression is 0.509 (95% CI 0.365 to 0.710). We can then calculate the mean and standard error on the log scale.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>rr_mean &lt;-<span class="st"> </span><span class="fl">.509</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>lrr_mean &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(.<span class="dv">509</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a>lrr_se &lt;-<span class="st"> </span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(.<span class="dv">710</span>) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(.<span class="dv">365</span>))<span class="op">/</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/Normal">qnorm</a></span>(.<span class="dv">975</span>))</span></code></pre></div>
<p>We compute the posterior distribution of transition probabilities for both monotherapy and combination therapy using <code>Stan</code>. Transition probabilities for monotherapy are drawn from Dirichlet distributions given the concentration parameters <span class="math inline">\(\alpha\)</span> and transition probabilities for combination therapy are computed by applying the relative risks to the transition probability matrix for monotherapy. Since the parameters of all distributions used for the PSA are known, there is no need to use Markov Chain Monte Carlo to estimate the parameters. We can consequently use the “generated quantities” block for random number generation to speed up computation time.</p>
<p>DTSTMs can be simulated in <code>hesim</code> using <code>tparams_transprobs</code> objects. To facilitate integration with Bayesian software like <code>Stan</code>, <code>tparams_transprobs</code> objects can be created from 4 dimensional arrays of transition probability matrices. The 1st dimension indexes random parameter samples, the 2nd dimension indexes treatment strategies, the third dimension indexes patients, and the fourth dimension indexes time intervals. In other words, the posterior distribution of transition probability matrices can vary across patients, treatment strategies, and time periods. The latter allows for time-inhomogeneous Markov models; in this example transition probabilites with combination therapy change after 2 years when patients move back to monotherapy.</p>
<pre><code>functions {
 // Function to apply a relative risk to a transition probability matrix
 matrix adjust_p(matrix p, real rr){
    int n_cols = cols(p);
    int n_rows = rows(p);
    matrix[n_rows, n_cols] p_new = p;
    
    // Adjust each row of matrix using relative risks
    for (i in 1:n_rows){
       p_new[i, (i + 1):n_cols] = rr * p[i, (i + 1):n_cols];
       p_new[i, i] = 1 - sum(p_new[i, (i + 1):n_cols]);
    }
    return(p_new);
 }
}

data {
  int&lt;lower=0&gt; n_strategies; // Number of treatment strategies
  int&lt;lower=0&gt; n_patients; // Number of patients
  int&lt;lower=0&gt; n_times; // Number of time intervals
  matrix[4, 4] alpha; // Concentration parameters of Dirichlet distributions
  real lrr_mean; // Mean of the log relative risk
  real lrr_se; // Standard error of the log relative risk
}

transformed data{
  matrix[4, 4] t_alpha = alpha'; // Transpose alpha. This is needed to randomly
                                // sample from the Dirichlet distribution in Stan.
}

 generated quantities {
   matrix[4, 4] p_mono; // Transition probability matrix for monotherapy
   matrix[4, 4] p_combo; // Transition probability matrix for combination therapy
   matrix[4, 4] p[n_strategies, n_patients, n_times]; // 4D array to pass to hesim
   
   // Draw relative risk
   real rr = lognormal_rng(lrr_mean, lrr_se); 
   
   // Draw baseline transition probability matrix for monotherapy
   for (i in 1:4){
     p_mono[i, ] = dirichlet_rng(col(t_alpha, i))'; 
   }                                                
   
   // Compute transition probability matrix for combination therapy using 
   // relative risk
   p_combo = adjust_p(p_mono, rr);

   // Store transition probabilitiy matrices in 4D array 
   p[1, 1, 1] = p_mono;  // Monotherapy, time interval 1 
   p[2, 1, 1] = p_combo; // Combination therapy, time interval 1
   p[1, 1, 2] = p_mono;  // Monotherapy, time interval 2
   p[2, 1, 2] = p_mono;  // Combination therapy, time interval 2 (treatment is
                         // assumed to only last 2 years) 
}</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>stan_data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="dt">n_strategies =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(strategies), </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="dt">n_patients =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(patients), </span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="dt">n_times =</span> <span class="dv">2</span>,</span>
<span id="cb9-5"><a href="#cb9-5"></a>  <span class="dt">alpha =</span> alpha_mono,</span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="dt">lrr_mean =</span> lrr_mean,</span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="dt">lrr_se =</span> lrr_se</span>
<span id="cb9-8"><a href="#cb9-8"></a>)</span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"rstan"</span>)</span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/rstan/topics/rstan_options">rstan_options</a></span>(<span class="dt">auto_write =</span> <span class="ot">TRUE</span>)</span>
<span id="cb9-11"><a href="#cb9-11"></a>fit &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstan/topics/stan">stan</a></span>(</span>
<span id="cb9-12"><a href="#cb9-12"></a>  <span class="dt">file =</span> <span class="st">"dtstm-hiv.stan"</span>,  </span>
<span id="cb9-13"><a href="#cb9-13"></a>  <span class="dt">data =</span> stan_data,         </span>
<span id="cb9-14"><a href="#cb9-14"></a>  <span class="dt">chains =</span> <span class="dv">1</span>,             </span>
<span id="cb9-15"><a href="#cb9-15"></a>  <span class="dt">warmup =</span> <span class="dv">0</span>,             </span>
<span id="cb9-16"><a href="#cb9-16"></a>  <span class="dt">iter =</span> n_samples,            </span>
<span id="cb9-17"><a href="#cb9-17"></a>  <span class="dt">cores =</span> <span class="dv">2</span>,              </span>
<span id="cb9-18"><a href="#cb9-18"></a>  <span class="dt">algorithm =</span> <span class="st">"Fixed_param"</span></span>
<span id="cb9-19"><a href="#cb9-19"></a>  )</span></code></pre></div>
<pre><code>## 
## SAMPLING FOR MODEL 'dtstm-hiv' NOW (CHAIN 1).
## Chain 1: Iteration:   1 / 1000 [  0%]  (Sampling)
## Chain 1: Iteration: 100 / 1000 [ 10%]  (Sampling)
## Chain 1: Iteration: 200 / 1000 [ 20%]  (Sampling)
## Chain 1: Iteration: 300 / 1000 [ 30%]  (Sampling)
## Chain 1: Iteration: 400 / 1000 [ 40%]  (Sampling)
## Chain 1: Iteration: 500 / 1000 [ 50%]  (Sampling)
## Chain 1: Iteration: 600 / 1000 [ 60%]  (Sampling)
## Chain 1: Iteration: 700 / 1000 [ 70%]  (Sampling)
## Chain 1: Iteration: 800 / 1000 [ 80%]  (Sampling)
## Chain 1: Iteration: 900 / 1000 [ 90%]  (Sampling)
## Chain 1: Iteration: 1000 / 1000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 0 seconds (Warm-up)
## Chain 1:                0.010759 seconds (Sampling)
## Chain 1:                0.010759 seconds (Total)
## Chain 1:</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>fit_params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstan/topics/stanfit-method-extract">extract</a></span>(fit)</span></code></pre></div>
</div>
<div id="utility-and-costs" class="section level2">
<h2 class="hasAnchor">
<a href="#utility-and-costs" class="anchor"></a><span class="header-section-number">2.2</span> Utility and costs</h2>
<p>Utility and cost parameters could be sampled using <code>Stan</code>; however, the cost and utility specifications are simple enough in this example that it is more straightforward to only use <code>R</code>. The cost-effectiveness analysis is based on life-years, meaning that each health state is assigned a utility value of 1.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>utility_tbl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stateval_tbl.html">stateval_tbl</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(<span class="dt">state_id =</span> states<span class="op">$</span>state_id,</span>
<span id="cb12-2"><a href="#cb12-2"></a>                                       <span class="dt">est =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(states))),</span>
<span id="cb12-3"><a href="#cb12-3"></a>                            <span class="dt">dist =</span> <span class="st">"fixed"</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>                            <span class="dt">hesim_data =</span> hesim_dat)</span></code></pre></div>
<p>The costs of zidovudine and lamivudine are $2,278 and $2,086.50, respectively. Drug costs in the monotherapy treatment strategy only include the cost of zidovudine whereas the combination therapy includes the costs of both zidovudine and lamivudine. However, as noted above, patients are only assumed to use lamivudine for two years. Time-varying drug costs are specified by allowing costs to vary in different time intervals. (Note that time intervals are open on the right so the second time interval must start at a time strictly greater than 2.)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Drug costs</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>cost_zido &lt;-<span class="st"> </span><span class="dv">2278</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>cost_lam &lt;-<span class="st"> </span><span class="fl">2086.50</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>drugcost_tbl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stateval_tbl.html">stateval_tbl</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(<span class="dt">strategy_id =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(strategies<span class="op">$</span>strategy_id, </span>
<span id="cb13-5"><a href="#cb13-5"></a>                                                          <span class="dt">each =</span> <span class="dv">2</span>),</span>
<span id="cb13-6"><a href="#cb13-6"></a>                                       <span class="dt">est =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(cost_zido, cost_zido,</span>
<span id="cb13-7"><a href="#cb13-7"></a>                                               cost_zido <span class="op">+</span><span class="st"> </span>cost_lam, cost_zido),</span>
<span id="cb13-8"><a href="#cb13-8"></a>                                       <span class="dt">time_start =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="fl">2.01</span>), <span class="dv">2</span>)),</span>
<span id="cb13-9"><a href="#cb13-9"></a>                            <span class="dt">dist =</span> <span class="st">"fixed"</span>,</span>
<span id="cb13-10"><a href="#cb13-10"></a>                            <span class="dt">hesim_data =</span> hesim_dat) </span></code></pre></div>
<p>Medical costs are split into direct medical and community medical costs. Costs vary across the three non-death health states and are assumed to follow a gamma distribution.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Direct medical costs</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>dmedcost_tbl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stateval_tbl.html">stateval_tbl</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(<span class="dt">state_id =</span> states<span class="op">$</span>state_id,</span>
<span id="cb14-3"><a href="#cb14-3"></a>                                       <span class="dt">mean =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1701</span>, <span class="dv">1774</span>, <span class="dv">6948</span>),</span>
<span id="cb14-4"><a href="#cb14-4"></a>                                       <span class="dt">se =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1701</span>, <span class="dv">1774</span>, <span class="dv">6948</span>)),</span>
<span id="cb14-5"><a href="#cb14-5"></a>                            <span class="dt">dist =</span> <span class="st">"gamma"</span>,</span>
<span id="cb14-6"><a href="#cb14-6"></a>                            <span class="dt">hesim_data =</span> hesim_dat) </span>
<span id="cb14-7"><a href="#cb14-7"></a></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co"># Community medical costs</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>cmedcost_tbl &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stateval_tbl.html">stateval_tbl</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(<span class="dt">state_id =</span> states<span class="op">$</span>state_id,</span>
<span id="cb14-10"><a href="#cb14-10"></a>                                       <span class="dt">mean =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1055</span>, <span class="dv">1278</span>, <span class="dv">2059</span>),</span>
<span id="cb14-11"><a href="#cb14-11"></a>                                       <span class="dt">se =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1055</span>, <span class="dv">1278</span>, <span class="dv">2059</span>)),</span>
<span id="cb14-12"><a href="#cb14-12"></a>                            <span class="dt">dist =</span> <span class="st">"gamma"</span>,</span>
<span id="cb14-13"><a href="#cb14-13"></a>                            <span class="dt">hesim_data =</span> hesim_dat) </span></code></pre></div>
</div>
</div>
<div id="simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation" class="anchor"></a><span class="header-section-number">3</span> Simulation</h1>
<div id="constructing-the-economic-model" class="section level2">
<h2 class="hasAnchor">
<a href="#constructing-the-economic-model" class="anchor"></a><span class="header-section-number">3.1</span> Constructing the economic model</h2>
<div id="disease-model" class="section level3">
<h3 class="hasAnchor">
<a href="#disease-model" class="anchor"></a><span class="header-section-number">3.1.1</span> Disease model</h3>
<p>The health state transition model is instantitated from a <code>tparams_transprobs</code> created using the array of transition probability distributions sampled using <code>Stan</code>. Combination therapy includes lamivudine during years 0-2 but is equivalent to monotherapy therafter. At the start of the model, all patients are assumed to be in State A.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>transmod_params &lt;-<span class="st"> </span><span class="kw"><a href="../reference/tparams_transprobs.html">tparams_transprobs</a></span>(fit_params<span class="op">$</span>p, <span class="dt">time_start =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="fl">2.01</span>))</span>
<span id="cb15-2"><a href="#cb15-2"></a>transmod &lt;-<span class="st"> </span>CohortDtstmTrans<span class="op">$</span><span class="kw">new</span>(<span class="dt">params =</span> transmod_params,</span>
<span id="cb15-3"><a href="#cb15-3"></a>                                 <span class="dt">start_stateprobs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span></code></pre></div>
</div>
<div id="utility-and-cost-models" class="section level3">
<h3 class="hasAnchor">
<a href="#utility-and-cost-models" class="anchor"></a><span class="header-section-number">3.1.2</span> Utility and cost models</h3>
<p>Models for utility and costs are easily created using the <code><a href="../reference/create_StateVals.html">create_StateVals()</a></code> function.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Utility</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>utilitymod &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_StateVals.html">create_StateVals</a></span>(utility_tbl, <span class="dt">n =</span> n_samples)</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co"># Costs</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>drugcostmod &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_StateVals.html">create_StateVals</a></span>(drugcost_tbl, <span class="dt">n =</span> n_samples)</span>
<span id="cb16-6"><a href="#cb16-6"></a>dmedcostmod &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_StateVals.html">create_StateVals</a></span>(dmedcost_tbl, <span class="dt">n =</span> n_samples)</span>
<span id="cb16-7"><a href="#cb16-7"></a>cmedcostmod &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_StateVals.html">create_StateVals</a></span>(cmedcost_tbl, <span class="dt">n =</span> n_samples)</span>
<span id="cb16-8"><a href="#cb16-8"></a>costmods &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="st">"Drug"</span> =<span class="st"> </span>drugcostmod,</span>
<span id="cb16-9"><a href="#cb16-9"></a>                 <span class="st">"Direct medical"</span> =<span class="st"> </span>dmedcostmod,</span>
<span id="cb16-10"><a href="#cb16-10"></a>                 <span class="st">"Community medical"</span> =<span class="st"> </span>cmedcostmod)</span></code></pre></div>
</div>
<div id="combining-the-disease-progression-cost-and-utility-models" class="section level3">
<h3 class="hasAnchor">
<a href="#combining-the-disease-progression-cost-and-utility-models" class="anchor"></a><span class="header-section-number">3.1.3</span> Combining the disease progression, cost, and utility models</h3>
<p>The transition, utility, and cost models are combined to create an economic model for simulating disease progression, costs, and utilities.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>econmod &lt;-<span class="st"> </span>CohortDtstm<span class="op">$</span><span class="kw">new</span>(<span class="dt">trans_model =</span> transmod,</span>
<span id="cb17-2"><a href="#cb17-2"></a>                           <span class="dt">utility_model =</span> utilitymod,</span>
<span id="cb17-3"><a href="#cb17-3"></a>                           <span class="dt">cost_models =</span> costmods)</span></code></pre></div>
</div>
</div>
<div id="simulating-outcomes" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-outcomes" class="anchor"></a><span class="header-section-number">3.2</span> Simulating outcomes</h2>
<div id="health-state-probabilities" class="section level3">
<h3 class="hasAnchor">
<a href="#health-state-probabilities" class="anchor"></a><span class="header-section-number">3.2.1</span> Health state probabilities</h3>
<p>State occupancy probabilities are generated by simulating the discrete time Markov chain. As expected, patients survive longer with combination therapy.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>econmod<span class="op">$</span><span class="kw">sim_stateprobs</span>(<span class="dt">n_cycles =</span> <span class="dv">20</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># Plot</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>())</span>
<span id="cb18-6"><a href="#cb18-6"></a>stateprob_summary &lt;-<span class="st"> </span>econmod<span class="op">$</span>stateprobs_[, .(<span class="dt">prob_mean =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(prob),</span>
<span id="cb18-7"><a href="#cb18-7"></a>                                              <span class="dt">prob_lower =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/quantile">quantile</a></span>(prob, <span class="fl">.025</span>),</span>
<span id="cb18-8"><a href="#cb18-8"></a>                                              <span class="dt">prob_upper =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/quantile">quantile</a></span>(prob, <span class="fl">.975</span>)),</span>
<span id="cb18-9"><a href="#cb18-9"></a>                                          by =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"strategy_id"</span>, <span class="st">"state_id"</span>, <span class="st">"t"</span>)]</span>
<span id="cb18-10"><a href="#cb18-10"></a>stateprob_summary[, strategy_name <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(strategy_id,</span>
<span id="cb18-11"><a href="#cb18-11"></a>                                          <span class="dt">labels =</span> strategies<span class="op">$</span>strategy_name)]</span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(stateprob_summary, <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> t, <span class="dt">y =</span> prob_mean)) <span class="op">+</span></span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">col =</span> strategy_name)) <span class="op">+</span></span>
<span id="cb18-14"><a href="#cb18-14"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span>(<span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> t, <span class="dt">ymin =</span> prob_lower, <span class="dt">ymax =</span> prob_upper,</span>
<span id="cb18-15"><a href="#cb18-15"></a>                  <span class="dt">fill =</span> strategy_name), <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></span>
<span id="cb18-16"><a href="#cb18-16"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(<span class="op">~</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(state_id, <span class="dt">labels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(states<span class="op">$</span>state_name, <span class="st">"D"</span>))) <span class="op">+</span></span>
<span id="cb18-17"><a href="#cb18-17"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Year"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Probability"</span>) <span class="op">+</span></span>
<span id="cb18-18"><a href="#cb18-18"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_hue.html">scale_fill_discrete</a></span>(<span class="st">"Strategy"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_hue.html">scale_color_discrete</a></span>(<span class="st">"Strategy"</span>)</span></code></pre></div>
<p><img src="dtstm-hiv_files/figure-html/simStateprobs-1.png" width="672"></p>
</div>
<div id="costs-and-qalys" class="section level3">
<h3 class="hasAnchor">
<a href="#costs-and-qalys" class="anchor"></a><span class="header-section-number">3.2.2</span> Costs and QALYs</h3>
<p>Costs and quality-adjusted life-years (QALYs) are computed by integrating the previously simulated state probabilities. To maintain consistency with Chancellor et al., we approximate the integral with a right Riemann sum, which is simply a sum of costs and QALYs measured at the right endpoint of each interval (e.g., costs between model cycle 0 and 1 are measured at model cycle 1).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>econmod<span class="op">$</span><span class="kw"><a href="../reference/sim_wlos.html">sim_qalys</a></span>(<span class="dt">dr =</span> <span class="dv">0</span>, <span class="dt">method =</span> <span class="st">"riemann_right"</span>)</span>
<span id="cb19-2"><a href="#cb19-2"></a>econmod<span class="op">$</span><span class="kw"><a href="../reference/sim_wlos.html">sim_costs</a></span>(<span class="dt">dr =</span> <span class="fl">0.06</span>, <span class="dt">method =</span> <span class="st">"riemann_right"</span>)</span></code></pre></div>
</div>
</div>
</div>
<div id="decision-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#decision-analysis" class="anchor"></a><span class="header-section-number">4</span> Decision analysis</h1>
<p>A decision analysis is performed by comparing combination therapy to monotherapy.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>ce_sim &lt;-<span class="st"> </span>econmod<span class="op">$</span><span class="kw">summarize</span>()</span>
<span id="cb20-2"><a href="#cb20-2"></a>wtp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, <span class="dv">25000</span>, <span class="dv">500</span>)</span>
<span id="cb20-3"><a href="#cb20-3"></a>icea_pw_out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/icea.html">icea_pw</a></span>(ce_sim, <span class="dt">comparator =</span> <span class="dv">1</span>, <span class="dt">dr_qalys =</span> <span class="dv">0</span>, <span class="dt">dr_costs =</span> <span class="fl">.06</span>,</span>
<span id="cb20-4"><a href="#cb20-4"></a>                       <span class="dt">k =</span> wtp)</span></code></pre></div>
<p>The incremental cost-effectiveness ratio (ICER) estimated using means from the PSA is $6,352, which is very close to the estimate from the deterministic analysis from Chancellor et al. </p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="kw"><a href="../reference/icer_tbl.html">icer_tbl</a></span>(icea_pw_out)</span></code></pre></div>
<pre><code>##                   1   2                        
## Incremental QALYs "-" "0.93 (0.57, 1.21)"      
## Incremental costs "-" "5,890 (3,158, 9,984)"   
## Incremental NMB   "-" "40,469 (22,694, 54,550)"
## ICER              "-" "6,352"                  
## Conclusion        "-" "Cost-effective"</code></pre>
<p>A cost-effectiveness acceptability curve shows that the probability that combination therapy is more cost-effective than monotherapy increases quickly with the willingness to pay (WTP) for a QALY. At $10,000, the probability is 0.94 and approaches 1 at slightly higher WTP values.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(icea_pw_out<span class="op">$</span>ceac, </span>
<span id="cb23-2"><a href="#cb23-2"></a>       <span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> k, <span class="dt">y =</span> prob, </span>
<span id="cb23-3"><a href="#cb23-3"></a>           <span class="dt">col =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(strategy_id, <span class="dt">labels =</span> strategies<span class="op">$</span>strategy_name[<span class="op">-</span><span class="dv">1</span>]))) <span class="op">+</span></span>
<span id="cb23-4"><a href="#cb23-4"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>()  <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Willingness to pay"</span>) <span class="op">+</span></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Probability cost-effective"</span>) <span class="op">+</span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="dt">breaks =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Extremes">max</a></span>(wtp), <span class="dv">5000</span>), <span class="dt">label =</span> scales<span class="op">::</span>dollar) <span class="op">+</span></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/scale_hue.html">scale_colour_discrete</a></span>(<span class="dt">name =</span> <span class="st">"Strategy"</span>)</span></code></pre></div>
<p><img src="dtstm-hiv_files/figure-html/ceac-1.png" width="672"></p>
</div>
<div id="appendix-dirichlet-distribution" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix-dirichlet-distribution" class="anchor"></a><span class="header-section-number">5</span> Appendix: Dirichlet distribution</h1>
<p>The multinomial distribution is a discrete probability distribution for the number of successes for each of k mutually exclusive categories in n trials. The probabilities of the categories are given by <span class="math inline">\(\pi_1,\ldots, \pi_k\)</span> with <span class="math inline">\(\sum_{j=1}^k \pi_j=1\)</span> and each <span class="math inline">\(\pi_j\)</span> defined on <span class="math inline">\([0,1]\)</span>. The Dirichlet distribution is parameterized by the concentration parameters <span class="math inline">\(\alpha_1,\ldots, \alpha_k\)</span> with <span class="math inline">\(\alpha_j &gt; 0\)</span>. Letting <span class="math inline">\(x_1,\ldots, x_k\)</span> denote the number of successes in each category, the prior distribution and likelihood are,</p>
<p><span class="math display">\[
\begin{aligned}
p(\pi_1,\ldots,\pi_k |\alpha_1,\ldots, \alpha_k) = \text{Dirichlet}(\alpha_1,\ldots,\alpha_k) \\
p(x_1,\ldots,x_k | \pi_1,\ldots,\pi_k) = \text{Multin}(n, \pi_1,\ldots,\pi_k).
\end{aligned}
\]</span></p>
<p>The posterior distribution for <span class="math inline">\(\pi_1,\ldots,\pi_k\)</span> is then given by,</p>
<p><span class="math display">\[
p\left(\pi_1,\ldots,\pi_k| x_1,\ldots,x_k, \alpha_1,\ldots,\alpha_k \right) = \text{Dirichlet}\left(\alpha_1 + x_1, \ldots, \alpha_k + x_k\right).
\]</span></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview"><span class="toc-section-number">1</span> Overview</a></li>
      <li>
<a href="#parameter-estimation"><span class="toc-section-number">2</span> Parameter estimation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#transition-probabilities"><span class="toc-section-number">2.1</span> Transition probabilities</a></li>
      <li><a href="#utility-and-costs"><span class="toc-section-number">2.2</span> Utility and costs</a></li>
      </ul>
</li>
      <li>
<a href="#simulation"><span class="toc-section-number">3</span> Simulation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#constructing-the-economic-model"><span class="toc-section-number">3.1</span> Constructing the economic model</a></li>
      <li><a href="#simulating-outcomes"><span class="toc-section-number">3.2</span> Simulating outcomes</a></li>
      </ul>
</li>
      <li><a href="#decision-analysis"><span class="toc-section-number">4</span> Decision analysis</a></li>
      <li><a href="#appendix-dirichlet-distribution"><span class="toc-section-number">5</span> Appendix: Dirichlet distribution</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
