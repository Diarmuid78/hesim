<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time inhomogeneous Markov cohort models • hesim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Time inhomogeneous Markov cohort models">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hesim</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.2.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">API</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction to hesim</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Markov cohort models</li>
    <li>
      <a href="../articles/getting-started.html">Getting started with a Markov cohort model</a>
    </li>
    <li>
      <a href="../articles/markov-inhomogeneous.html">Time inhomogeneous Markov cohort model</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Statistical models of disease progression</li>
    <li>
      <a href="../articles/mlogit.html">Markov models with multinomial logistic regression</a>
    </li>
    <li>
      <a href="../articles/psm.html">Partitioned survival models</a>
    </li>
    <li>
      <a href="../articles/ctstm.html">Markov and semi-Markov multi-state models</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Economic analysis</li>
    <li>
      <a href="../articles/expected-values.html">Simulating costs and quality-adjusted life-years</a>
    </li>
    <li>
      <a href="../articles/icea.html">Individualized cost-effectiveness analysis</a>
    </li>
    <li class="divider">
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hesim-dev/hesim">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="markov-inhomogeneous_files/kePrint-0.0.1/kePrint.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Time inhomogeneous Markov cohort models</h1>
            
            <h4 class="date">2020-03-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hesim-dev/hesim/blob/master/vignettes/markov-inhomogeneous.Rmd"><code>vignettes/markov-inhomogeneous.Rmd</code></a></small>
      <div class="hidden name"><code>markov-inhomogeneous.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a><span class="header-section-number">1</span> Overview</h1>
<p>We will illustrate a time inhomogeneous Markov cohort model by replicating the total hip replacement (THR) example from the <a href="https://www.herc.ox.ac.uk/downloads/decision-modelling-for-health-economic-evaluation"><em>Decision Modeling for Health Economic Evaluation</em></a> textbook. The analysis compares two treatment strategies, a “standard” prosthesis and a “new” prosthesis. A probabilistic sensitivity analysis (PSA) will be used to quantify parameter uncertainty.</p>
<p>The model consists 5 health states: (i) primary THR, (ii) successful primary, (iii) revision THR, (iv) successful revision, and (v) death.</p>
<p><img src="subgroup.png" width="700px"></p>
<p>The model is time-inhomogeneous because (i) the prosthesis survival time is modeled using a Weibull survival model so that the probability of failure is time-varying and (ii) background mortality rates increase as patients age.</p>
</div>
<div id="define-the-model" class="section level1">
<h1 class="hasAnchor">
<a href="#define-the-model" class="anchor"></a><span class="header-section-number">2</span> Define the model</h1>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a><span class="header-section-number">2.1</span> Data</h2>
<p>We set up the model for two treatment strategies and 10 subgroups defined by age and sex.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"hesim"</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"data.table"</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Treatment strategies</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>strategies &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(<span class="dt">strategy_id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,</span>
<span id="cb1-6"><a href="#cb1-6"></a>                         <span class="dt">strategy_name =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Standard prosthesis"</span>, <span class="st">"New prosthesis"</span>))</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># Patients</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>ages &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">55</span>, <span class="dv">75</span>, <span class="dv">5</span>)</span>
<span id="cb1-10"><a href="#cb1-10"></a>age_weights &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(.<span class="dv">05</span>, <span class="fl">.1</span>, <span class="fl">.4</span>, <span class="fl">.25</span>, <span class="fl">.20</span>)</span>
<span id="cb1-11"><a href="#cb1-11"></a>gender_weights &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(.<span class="dv">65</span>, <span class="fl">.35</span>)</span>
<span id="cb1-12"><a href="#cb1-12"></a>weights &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(age_weights, <span class="dt">times =</span> <span class="dv">2</span>) <span class="op">*</span><span class="st"> </span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="st">           </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(gender_weights, <span class="dt">each =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(ages))</span>
<span id="cb1-14"><a href="#cb1-14"></a>patients &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/data.table/topics/data.table">data.table</a></span>(<span class="dt">patient_id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</span>
<span id="cb1-15"><a href="#cb1-15"></a>                       <span class="dt">grp_id =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</span>
<span id="cb1-16"><a href="#cb1-16"></a>                       <span class="dt">gender =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>), <span class="dt">each =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(ages)),</span>
<span id="cb1-17"><a href="#cb1-17"></a>                       <span class="dt">age =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(ages, <span class="dt">times =</span> <span class="dv">2</span>),</span>
<span id="cb1-18"><a href="#cb1-18"></a>                       <span class="dt">patient_wt =</span> weights)</span>
<span id="cb1-19"><a href="#cb1-19"></a>hesim_dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hesim_data.html">hesim_data</a></span>(<span class="dt">strategies =</span> strategies,</span>
<span id="cb1-20"><a href="#cb1-20"></a>                        <span class="dt">patients =</span> patients)</span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(hesim_dat)</span></code></pre></div>
<pre><code>## $strategies
##    strategy_id       strategy_name
## 1:           1 Standard prosthesis
## 2:           2      New prosthesis
## 
## $patients
##     patient_id grp_id gender age patient_wt
##  1:          1      1 Female  55     0.0325
##  2:          2      2 Female  60     0.0650
##  3:          3      3 Female  65     0.2600
##  4:          4      4 Female  70     0.1625
##  5:          5      5 Female  75     0.1300
##  6:          6      6   Male  55     0.0175
##  7:          7      7   Male  60     0.0350
##  8:          8      8   Male  65     0.1400
##  9:          9      9   Male  70     0.0875
## 10:         10     10   Male  75     0.0700
## 
## attr(,"class")
## [1] "hesim_data"</code></pre>
<p>The model will be simulated for each treatment strategy and patient combination. Data containing treatment strategy and patient characteristics can be generated using <code><a href="../reference/expand.html">expand()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expand.html">expand</a></span>(hesim_dat, <span class="dt">by =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"strategies"</span>, <span class="st">"patients"</span>))</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(data)</span></code></pre></div>
<pre><code>##    strategy_id patient_id       strategy_name grp_id gender age patient_wt
## 1:           1          1 Standard prosthesis      1 Female  55     0.0325
## 2:           1          2 Standard prosthesis      2 Female  60     0.0650
## 3:           1          3 Standard prosthesis      3 Female  65     0.2600
## 4:           1          4 Standard prosthesis      4 Female  70     0.1625
## 5:           1          5 Standard prosthesis      5 Female  75     0.1300
## 6:           1          6 Standard prosthesis      6   Male  55     0.0175</code></pre>
</div>
<div id="parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#parameters" class="anchor"></a><span class="header-section-number">2.2</span> Parameters</h2>
<div id="transition-probabilities" class="section level3">
<h3 class="hasAnchor">
<a href="#transition-probabilities" class="anchor"></a><span class="header-section-number">2.2.1</span> Transition probabilities</h3>
<p>Transition probabilities from state <span class="math inline">\(i\)</span> (rows) to state <span class="math inline">\(j\)</span> (columns) are determined using the parameters shown in the table below:</p>
<ul>
<li>
<strong>C</strong>: The complement of other probabilities in a given row</li>
<li>
<strong>omrPTHR</strong>: Operative mortality rate following primary THR</li>
<li>
<strong>rr</strong>: Revision rate for prosthesis</li>
<li>
<strong>mr</strong>: Age and gender-specific mortality rates</li>
<li>
<strong>omrRTHR</strong>: Operative mortality rate following revision THR</li>
<li>
<strong>rrr</strong>: Re-revision rate</li>
</ul>
<table class="table table">
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Primary THR
</th>
<th style="text-align:left;">
Successful primary
</th>
<th style="text-align:left;">
Revision THR
</th>
<th style="text-align:left;">
Successful revision
</th>
<th style="text-align:left;">
Death
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Primary THR
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
omrPTHR
</td>
</tr>
<tr>
<td style="text-align:left;">
Successful primary
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
rr
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
mr
</td>
</tr>
<tr>
<td style="text-align:left;">
Revision THR
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
omrRTHR + mr
</td>
</tr>
<tr>
<td style="text-align:left;">
Successful revision
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
rrr
</td>
<td style="text-align:left;">
C
</td>
<td style="text-align:left;">
mr
</td>
</tr>
<tr>
<td style="text-align:left;">
Death
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
1
</td>
</tr>
</tbody>
</table>
<p>Three parameters of the transition probability matrix are assumed to be constant in the model: (i) the operative mortality rate following primary THR, <em>omrPTHR</em>, (ii) the operative mortality rate following revision THR, <em>omrRTHR</em>, and the re-revision rate, <em>rrr</em>. In a sample of 100 patients receiving primary THR 2 died implying that <em>omrPTHR</em> can be characterized by a beta distribution with <span class="math inline">\(\alpha = 2\)</span> and <span class="math inline">\(\beta = 98\)</span>. Similarly, in a sample of 100 patients experiencing a revision procedure, four patients had another procedure within one year suggesting that <em>rrr</em> can be characterized by a beta distribution with <span class="math inline">\(\alpha = 4\)</span> and <span class="math inline">\(\beta = 96\)</span>. Finally. there was information available for <em>omrRTHR</em>, so it assumed to follow the same beta distribution (<span class="math inline">\(\alpha = 2\)</span> and <span class="math inline">\(\beta = 98\)</span>) as <em>omrPTHR</em>.</p>
<p>The remaining parameters, <em>rr</em> and <em>mr</em>, are time-varying. The yearly mortality rates, <em>mr</em>, are stratified by age and sex.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(mort_tbl)</span></code></pre></div>
<pre><code>##   age_lower age_upper    male  female
## 1        35        45 0.00151 0.00099
## 2        45        55 0.00393 0.00260
## 3        55        65 0.01090 0.00670
## 4        65        75 0.03160 0.01930
## 5        75        85 0.08010 0.05350
## 6        85       Inf 0.18790 0.15480</code></pre>
<p>Revision rates, <em>rr</em>, were modeled using a proportional hazards Weibull model. The scale parameter was modeled as a function of age and indicators for male sex and and whether a new prosthesis was used. That is, given a scale parameter <span class="math inline">\(\lambda\)</span> and a shape parameter <span class="math inline">\(\gamma\)</span>, the survival function is,</p>
<p><span class="math display">\[
S(t) = \exp(-\lambda t^\gamma) \\
\lambda = \exp(\beta_0 + \beta_1 \cdot age + \beta_2 \cdot male + \beta_3 \cdot new) \\
\]</span></p>
<p>Note that this Weibull distribution corresponds to the distribution implemented in <code><a href="https://www.rdocumentation.org/packages/flexsurv/topics/WeibullPH">flexsurv::pweibullPH()</a></code> with <span class="math inline">\(a = \gamma\)</span> and <span class="math inline">\(m = \lambda\)</span>. It can be shown (see Appendix below) that the transition probabilities (with a one-year model cycle) are given by,</p>
<p><span class="math display">\[
1 - \exp \left\{\lambda\left[(t-1)^\gamma - t^\gamma \right] \right\}
\]</span> The coefficients from the regression model and the variance-covariance matrix used for the PSA are stored in <code>rr_coef</code> and <code>rr_vcov</code>, respectively.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(rr_coef)</span></code></pre></div>
<pre><code>##    lngamma       cons        age       male        np1 
##  0.3740968 -5.4909350 -0.0367022  0.7685360 -1.3444740</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(rr_vcov)</span></code></pre></div>
<pre><code>##              lngamma        cons           age        male        np1
## lngamma  0.002251512 -0.00569100  2.800000e-08  0.00000510  0.0002590
## cons    -0.005691000  0.04321908 -7.830000e-04 -0.00724700 -0.0006420
## age      0.000000028 -0.00078300  2.715661e-05  0.00003300 -0.0001110
## male     0.000005100 -0.00724700  3.300000e-05  0.01189539  0.0001840
## np1      0.000259000 -0.00064200 -1.110000e-04  0.00018400  0.1463686</code></pre>
</div>
<div id="utility" class="section level3">
<h3 class="hasAnchor">
<a href="#utility" class="anchor"></a><span class="header-section-number">2.2.2</span> Utility</h3>
<p>The mean (standard error) of utility was estimated to be 0.85 (0.03), 0.30 (0.03), and 0.75 (0.04) in the successful primary, revision, and successful revision health states, respectively.</p>
</div>
<div id="costs" class="section level3">
<h3 class="hasAnchor">
<a href="#costs" class="anchor"></a><span class="header-section-number">2.2.3</span> Costs</h3>
<p>The largest costs are the cost of the prostheses themselves. The standard prosthesis costs <span class="math inline">\(£394\)</span> while the new prosthesis costs <span class="math inline">\(£579\)</span>. Both are assumed to be known with certainty.</p>
<p>The model assumes that there are no ongoing medical costs. The only remaining cost is therefore the cost of the revision procedure, which was estimated to have a mean of <span class="math inline">\(£5,294\)</span> and standard error of <span class="math inline">\(£1,487\)</span>.</p>
</div>
<div id="combining-all-parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#combining-all-parameters" class="anchor"></a><span class="header-section-number">2.2.4</span> Combining all parameters</h3>
<p>All underlying parameter estimates are stored in a list.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>params &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="co"># Transition probabilities</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="co">## Operative mortality following primary THR</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="dt">omrPTHR_shape1 =</span> <span class="dv">2</span>, </span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="dt">omrPTHR_shape2 =</span> <span class="dv">98</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>  </span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="co">## Revision rate for prosthesis</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>  <span class="dt">rr_coef =</span> rr_coef,</span>
<span id="cb11-9"><a href="#cb11-9"></a>  <span class="dt">rr_vcov =</span> rr_vcov,</span>
<span id="cb11-10"><a href="#cb11-10"></a>    </span>
<span id="cb11-11"><a href="#cb11-11"></a>  <span class="co">## Mortality_rates</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>  <span class="dt">mr =</span> mort_tbl,</span>
<span id="cb11-13"><a href="#cb11-13"></a>  </span>
<span id="cb11-14"><a href="#cb11-14"></a>  <span class="co">## Operative mortality following revision THR</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>  <span class="dt">omrRTHR_shape1 =</span> <span class="dv">2</span>,</span>
<span id="cb11-16"><a href="#cb11-16"></a>  <span class="dt">omrRTHR_shape2 =</span> <span class="dv">98</span>,</span>
<span id="cb11-17"><a href="#cb11-17"></a>  </span>
<span id="cb11-18"><a href="#cb11-18"></a>  <span class="co">## re-revision rate</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>  <span class="dt">rrr_shape1 =</span> <span class="dv">4</span>,</span>
<span id="cb11-20"><a href="#cb11-20"></a>  <span class="dt">rrr_shape2 =</span> <span class="dv">96</span>,</span>
<span id="cb11-21"><a href="#cb11-21"></a>  </span>
<span id="cb11-22"><a href="#cb11-22"></a>  <span class="co"># Utility</span></span>
<span id="cb11-23"><a href="#cb11-23"></a>  <span class="dt">u_mean =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">PrimaryTHR =</span> <span class="dv">0</span>, <span class="dt">SuccessP =</span> <span class="fl">.85</span>, <span class="dt">Revision =</span> <span class="fl">.30</span>, <span class="dt">SuccessR =</span> <span class="fl">.75</span>),</span>
<span id="cb11-24"><a href="#cb11-24"></a>  <span class="dt">u_se =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">PrimaryTHR =</span> <span class="dv">0</span>, <span class="dt">SuccessP =</span> <span class="fl">.03</span>, <span class="dt">Revision =</span> <span class="fl">.03</span>, <span class="dt">SuccessR =</span> <span class="fl">.04</span>),</span>
<span id="cb11-25"><a href="#cb11-25"></a>  </span>
<span id="cb11-26"><a href="#cb11-26"></a>  <span class="co"># Costs</span></span>
<span id="cb11-27"><a href="#cb11-27"></a>  <span class="dt">c_med_mean =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">PrimaryTHR =</span> <span class="dv">0</span>, <span class="dt">SuccessP =</span> <span class="dv">0</span>, <span class="dt">Revision =</span> <span class="dv">5294</span>, <span class="dt">SuccessR =</span> <span class="dv">0</span>),</span>
<span id="cb11-28"><a href="#cb11-28"></a>  <span class="dt">c_med_se =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">PrimaryTHR =</span> <span class="dv">0</span>, <span class="dt">SuccessP =</span> <span class="dv">0</span>, <span class="dt">Revision =</span> <span class="dv">1487</span>, <span class="dt">SuccessR =</span> <span class="dv">0</span>),</span>
<span id="cb11-29"><a href="#cb11-29"></a>  <span class="dt">c_Standard =</span> <span class="dv">394</span>,</span>
<span id="cb11-30"><a href="#cb11-30"></a>  <span class="dt">c_NP1 =</span> <span class="dv">579</span></span>
<span id="cb11-31"><a href="#cb11-31"></a>)</span></code></pre></div>
</div>
</div>
<div id="random-number-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#random-number-generation" class="anchor"></a><span class="header-section-number">2.3</span> Random number generation</h2>
<p>As noted above, <em>omrPTHR</em>, <em>omrRTHR</em>, and <em>rrr</em> are drawn from beta distributions whith <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> (i.e. <code>shape1</code> and <code>shape2</code>) specified. Similarly, utility is drawn from a beta distribution, but <code>shape1</code> and <code>shape2</code> are derived from the mean and standard error using the method of moments. The mortality rate and the cost of the prostheses are assumed to be known with certainty. The medical costs associated with health states are drawn from a gamma distribution, for which, like utility, the underlying parameters are derived from the mean and standard error using the method of moments. Finally, the parameters of the Weibull survival model are drawn from a multivariate normal distribution using the point estimates and the variance-covariance matrix. 500 samples will be drawn for the PSA.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>rng_def &lt;-<span class="st"> </span><span class="kw"><a href="../reference/define_rng.html">define_rng</a></span>({</span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>( </span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="dt">omrPTHR =</span> <span class="kw"><a href="../reference/rng_distributions.html">beta_rng</a></span>(<span class="dt">shape1 =</span> omrPTHR_shape1, <span class="dt">shape2 =</span> omrPTHR_shape2),</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="dt">rr_coef =</span> <span class="kw"><a href="../reference/rng_distributions.html">multi_normal_rng</a></span>(<span class="dt">mu =</span> rr_coef, <span class="dt">Sigma =</span> rr_vcov),</span>
<span id="cb12-5"><a href="#cb12-5"></a>    <span class="dt">mr_male =</span> <span class="kw"><a href="../reference/rng_distributions.html">fixed</a></span>(mr<span class="op">$</span>male, <span class="dt">names =</span> mr<span class="op">$</span>age_lower),</span>
<span id="cb12-6"><a href="#cb12-6"></a>    <span class="dt">mr_female =</span> <span class="kw"><a href="../reference/rng_distributions.html">fixed</a></span>(mr<span class="op">$</span>female, <span class="dt">names =</span> mr<span class="op">$</span>age_lower),</span>
<span id="cb12-7"><a href="#cb12-7"></a>    <span class="dt">omrRTHR =</span> <span class="kw"><a href="../reference/rng_distributions.html">beta_rng</a></span>(<span class="dt">shape1 =</span> omrRTHR_shape1, <span class="dt">shape2 =</span> omrRTHR_shape2),</span>
<span id="cb12-8"><a href="#cb12-8"></a>    <span class="dt">rrr =</span> <span class="kw"><a href="../reference/rng_distributions.html">beta_rng</a></span>(<span class="dt">shape1 =</span> rrr_shape1, <span class="dt">shape2 =</span> rrr_shape2),</span>
<span id="cb12-9"><a href="#cb12-9"></a>    <span class="dt">u =</span> <span class="kw"><a href="../reference/rng_distributions.html">beta_rng</a></span>(<span class="dt">mean =</span> u_mean, <span class="dt">sd =</span> u_se),</span>
<span id="cb12-10"><a href="#cb12-10"></a>    <span class="dt">c_med =</span> <span class="kw"><a href="../reference/rng_distributions.html">gamma_rng</a></span>(<span class="dt">mean =</span> c_med_mean, <span class="dt">sd =</span> c_med_se),</span>
<span id="cb12-11"><a href="#cb12-11"></a>    <span class="dt">c_Standard =</span> c_Standard,</span>
<span id="cb12-12"><a href="#cb12-12"></a>    <span class="dt">c_NP1 =</span> c_NP1</span>
<span id="cb12-13"><a href="#cb12-13"></a>  )</span>
<span id="cb12-14"><a href="#cb12-14"></a>}, <span class="dt">n =</span> <span class="dv">500</span>)</span></code></pre></div>
</div>
<div id="transformed-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#transformed-parameters" class="anchor"></a><span class="header-section-number">2.4</span> Transformed parameters</h2>
<p>The sampled parameter values are “transformed” as a function of the input data. When evaluating the <code><a href="../reference/define_tparams.html">define_tparams()</a></code> expression, operations are vectorized and performed for each combination of the sampled parameters, input data, and time periods. The model will be simulated for 60 model cycles (i.e., 60 years) so we will create 60 time intervals of length 1.</p>
<p>Separate transformation functions are used for the transition model and the cost/utility models. This is done for computational efficiency since only the transition model depends on cycle time. In the transition model, the revision rate (<em>rr</em>) depends on the scale and the shape parameters, which, in turn, depend on the sampled values of the parameters from the Weibull model. The mortality rate depends on gender and a patient’s age during each model cycle.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>transitions_def &lt;-<span class="st"> </span><span class="kw"><a href="../reference/define_tparams.html">define_tparams</a></span>({</span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="co"># Regression for revision risk</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  male &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(gender <span class="op">==</span><span class="st"> "Female"</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a>  np1 &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(strategy_name <span class="op">==</span><span class="st"> "Standard prosthesis"</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb13-5"><a href="#cb13-5"></a>  scale &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(rr_coef<span class="op">$</span>cons <span class="op">+</span><span class="st"> </span>rr_coef<span class="op">$</span>age <span class="op">*</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>rr_coef<span class="op">$</span>male <span class="op">*</span><span class="st"> </span>male <span class="op">+</span><span class="st"> </span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="st">                 </span>rr_coef<span class="op">$</span>np1 <span class="op">*</span><span class="st"> </span>np1)</span>
<span id="cb13-7"><a href="#cb13-7"></a>  shape &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(rr_coef<span class="op">$</span>lngamma)</span>
<span id="cb13-8"><a href="#cb13-8"></a>  rr &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">exp</a></span>(scale <span class="op">*</span><span class="st"> </span>((time <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)<span class="op">^</span>shape <span class="op">-</span><span class="st"> </span>time<span class="op">^</span>shape))</span>
<span id="cb13-9"><a href="#cb13-9"></a>    </span>
<span id="cb13-10"><a href="#cb13-10"></a>  <span class="co"># Mortality rate</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  age_new &lt;-<span class="st"> </span>age <span class="op">+</span><span class="st"> </span>time</span>
<span id="cb13-12"><a href="#cb13-12"></a>  mr &lt;-<span class="st"> </span>mr_female[[<span class="st">"35"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Female"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">35</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">45</span>) <span class="op">+</span></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="st">        </span>mr_female[[<span class="st">"45"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Female"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">45</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">55</span>) <span class="op">+</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="st">        </span>mr_female[[<span class="st">"55"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Female"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">55</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">65</span>) <span class="op">+</span></span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="st">        </span>mr_female[[<span class="st">"65"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Female"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">65</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">75</span>) <span class="op">+</span></span>
<span id="cb13-16"><a href="#cb13-16"></a><span class="st">        </span>mr_female[[<span class="st">"75"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Female"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">75</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">85</span>) <span class="op">+</span></span>
<span id="cb13-17"><a href="#cb13-17"></a><span class="st">        </span>mr_female[[<span class="st">"85"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Female"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">85</span>) <span class="op">+</span></span>
<span id="cb13-18"><a href="#cb13-18"></a><span class="st">        </span></span>
<span id="cb13-19"><a href="#cb13-19"></a><span class="st">        </span>mr_male[[<span class="st">"35"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Male"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">35</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">45</span>) <span class="op">+</span></span>
<span id="cb13-20"><a href="#cb13-20"></a><span class="st">        </span>mr_male[[<span class="st">"45"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Male"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">45</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">55</span>) <span class="op">+</span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="st">        </span>mr_male[[<span class="st">"55"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Male"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">55</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">65</span>) <span class="op">+</span></span>
<span id="cb13-22"><a href="#cb13-22"></a><span class="st">        </span>mr_male[[<span class="st">"65"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Male"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">65</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">75</span>) <span class="op">+</span></span>
<span id="cb13-23"><a href="#cb13-23"></a><span class="st">        </span>mr_male[[<span class="st">"75"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Male"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">75</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&lt;</span><span class="st"> </span><span class="dv">85</span>) <span class="op">+</span></span>
<span id="cb13-24"><a href="#cb13-24"></a><span class="st">        </span>mr_male[[<span class="st">"85"</span>]] <span class="op">*</span><span class="st"> </span>(gender <span class="op">==</span><span class="st"> "Male"</span> <span class="op">&amp;</span><span class="st"> </span>age_new <span class="op">&gt;=</span><span class="st"> </span><span class="dv">85</span>)</span>
<span id="cb13-25"><a href="#cb13-25"></a>  </span>
<span id="cb13-26"><a href="#cb13-26"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</span>
<span id="cb13-27"><a href="#cb13-27"></a>    <span class="dt">tpmatrix =</span> <span class="kw"><a href="../reference/tpmatrix.html">tpmatrix</a></span>(</span>
<span id="cb13-28"><a href="#cb13-28"></a>      <span class="dv">0</span>, C, <span class="dv">0</span>, <span class="dv">0</span>, omrPTHR,</span>
<span id="cb13-29"><a href="#cb13-29"></a>      <span class="dv">0</span>, C, rr, <span class="dv">0</span>, mr,</span>
<span id="cb13-30"><a href="#cb13-30"></a>      <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, C, omrRTHR <span class="op">+</span><span class="st"> </span>mr,</span>
<span id="cb13-31"><a href="#cb13-31"></a>      <span class="dv">0</span>, <span class="dv">0</span>, rrr, C, mr,</span>
<span id="cb13-32"><a href="#cb13-32"></a>      <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb13-33"><a href="#cb13-33"></a>  )</span>
<span id="cb13-34"><a href="#cb13-34"></a>}, <span class="dt">times =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">60</span>)</span>
<span id="cb13-35"><a href="#cb13-35"></a></span>
<span id="cb13-36"><a href="#cb13-36"></a>statevals_def &lt;-<span class="st"> </span><span class="kw"><a href="../reference/define_tparams.html">define_tparams</a></span>({</span>
<span id="cb13-37"><a href="#cb13-37"></a>  c_prosthesis &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/ifelse">ifelse</a></span>(strategy_name <span class="op">==</span><span class="st"> "Standard prosthesis"</span>,</span>
<span id="cb13-38"><a href="#cb13-38"></a>                         c_Standard,</span>
<span id="cb13-39"><a href="#cb13-39"></a>                         c_NP1)</span>
<span id="cb13-40"><a href="#cb13-40"></a>  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</span>
<span id="cb13-41"><a href="#cb13-41"></a>    <span class="dt">utility =</span> u,</span>
<span id="cb13-42"><a href="#cb13-42"></a>    <span class="dt">costs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</span>
<span id="cb13-43"><a href="#cb13-43"></a>            <span class="dt">prosthesis =</span> c_prosthesis,</span>
<span id="cb13-44"><a href="#cb13-44"></a>      <span class="dt">medical =</span> c_med</span>
<span id="cb13-45"><a href="#cb13-45"></a>    )</span>
<span id="cb13-46"><a href="#cb13-46"></a>  )</span>
<span id="cb13-47"><a href="#cb13-47"></a>})</span></code></pre></div>
</div>
<div id="the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-model" class="anchor"></a><span class="header-section-number">2.5</span> The model</h2>
<p>The model is defined by specifying parameter estimates, a random number generation expression for the PSA, and the transformed parameter expressions.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>mod_def &lt;-<span class="st"> </span><span class="kw"><a href="../reference/define_model.html">define_model</a></span>(<span class="dt">tparams_def =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(transitions_def, </span>
<span id="cb14-2"><a href="#cb14-2"></a>                                           statevals_def),</span>
<span id="cb14-3"><a href="#cb14-3"></a>                        <span class="dt">rng_def =</span> rng_def, </span>
<span id="cb14-4"><a href="#cb14-4"></a>                        <span class="dt">params =</span> params)</span></code></pre></div>
</div>
</div>
<div id="simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation" class="anchor"></a><span class="header-section-number">3</span> Simulation</h1>
<p>The economic model is created from the input data and the defined model. Arguments for instantiating the cost models (a list of objects of class <code>StateVals</code>) can be specified with a named list containing the values of arguments to pass to <code>StateVals$new()</code>. In this case, we note that the model for the cost of the prostheses is based on one-time costs accrued at the start of the model (with no discounting); conversely, medical costs accrue by weighting state values by time spent in the health states (in the current model simply the cost of revision over 1 year).</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>cost_args &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(</span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="dt">prosthesis =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">method =</span> <span class="st">"starting"</span>),</span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="dt">medical =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">method =</span> <span class="st">"wlos"</span>)</span>
<span id="cb15-4"><a href="#cb15-4"></a>)</span>
<span id="cb15-5"><a href="#cb15-5"></a>econmod &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_CohortDtstm.html">create_CohortDtstm</a></span>(mod_def, data,</span>
<span id="cb15-6"><a href="#cb15-6"></a>                              <span class="dt">cost_args =</span> cost_args)</span></code></pre></div>
<div id="health-state-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#health-state-probabilities" class="anchor"></a><span class="header-section-number">3.1</span> Health state probabilities</h2>
<p>Health state probabilities are simulated for 60 model cycles.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>econmod<span class="op">$</span><span class="kw">sim_stateprobs</span>(<span class="dt">n_cycles =</span> <span class="dv">60</span>)</span></code></pre></div>
<p>The expected number of patients per 1,000 in each health state is plotted below. The counts in the plot are for <code>patient_id = 2</code>, a 60 year old female as in the original textbook example. Since a PSA was performed both mean values and 95 percent credible intervals can be displayed. Patients are more likely to have a revision with a standard prosthesis than with the new prosthesis.</p>
<p><img src="markov-inhomogeneous_files/figure-html/simStateprobsPlot-1.png" width="672"></p>
</div>
<div id="costs-and-qalys" class="section level2">
<h2 class="hasAnchor">
<a href="#costs-and-qalys" class="anchor"></a><span class="header-section-number">3.2</span> Costs and QALYs</h2>
<p>To again be consistent with the textbook example, QALYs and costs are simulated with discount rates of .015 and 0.06, respectively. QALYs and costs (when <code>method = "wlos"</code>) are computed with a right Riemann sum, meaning that they are measured at the right endpoint of each model cycle.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>econmod<span class="op">$</span><span class="kw"><a href="../reference/sim_ev.html">sim_qalys</a></span>(<span class="dt">dr =</span> <span class="fl">.015</span>, <span class="dt">integrate_method =</span> <span class="st">"riemann_right"</span>)</span>
<span id="cb17-2"><a href="#cb17-2"></a>econmod<span class="op">$</span><span class="kw"><a href="../reference/sim_ev.html">sim_costs</a></span>(<span class="dt">dr =</span> <span class="fl">.06</span>, <span class="dt">integrate_method =</span> <span class="st">"riemann_right"</span>)</span></code></pre></div>
</div>
</div>
<div id="decision-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#decision-analysis" class="anchor"></a><span class="header-section-number">4</span> Decision analysis</h1>
<div id="subgroup-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#subgroup-analysis" class="anchor"></a><span class="header-section-number">4.1</span> Subgroup analysis</h2>
<p>Subgroup analyses can be performed with <code>$sim_summarize()</code> using the <code>by_grp = TRUE</code> option. Cost-effectiveness analyses are then performed for each subgroup (<code>grp_id</code>) from input data. We will begin by reporting results for the 60-year old female, which are consistent with those from the textbook.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>ce_sim &lt;-<span class="st"> </span>econmod<span class="op">$</span><span class="kw">summarize</span>(<span class="dt">by_grp =</span> <span class="ot">TRUE</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a>wtp &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">0</span>, <span class="dv">25000</span>, <span class="dv">500</span>)</span>
<span id="cb18-3"><a href="#cb18-3"></a>icea_pw_out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/icea.html">icea_pw</a></span>(ce_sim, <span class="dt">comparator =</span> <span class="dv">1</span>, <span class="dt">dr_qalys =</span> <span class="fl">0.015</span>, <span class="dt">dr_costs =</span> <span class="fl">.06</span>,</span>
<span id="cb18-4"><a href="#cb18-4"></a>                       <span class="dt">k =</span> wtp)</span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a>ce_sim<span class="op">$</span>qalys[grp_id <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, </span>
<span id="cb18-7"><a href="#cb18-7"></a>              .(<span class="dt">mean =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(qalys)),</span>
<span id="cb18-8"><a href="#cb18-8"></a>                by =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"strategy_id"</span>, <span class="st">"grp_id"</span>)]</span></code></pre></div>
<pre><code>##    strategy_id grp_id     mean
## 1:           1      2 14.66715
## 2:           2      2 14.71131</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>ce_sim<span class="op">$</span>costs[grp_id <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;</span><span class="st"> </span>category <span class="op">==</span><span class="st"> "total"</span>, </span>
<span id="cb20-2"><a href="#cb20-2"></a>            .(<span class="dt">mean =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(costs)),</span>
<span id="cb20-3"><a href="#cb20-3"></a>              by =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"strategy_id"</span>, <span class="st">"grp_id"</span>)]</span></code></pre></div>
<pre><code>##    strategy_id grp_id     mean
## 1:           1      2 511.7251
## 2:           2      2 611.9571</code></pre>
<p>We can then compute incremental cost-effectiveness ratios for each subgroup. There is considerable variation which is not unexpected since the the revision rate for prostheses (<em>rr</em>) depends on covariates.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw"><a href="../reference/icer_tbl.html">icer_tbl</a></span>(icea_pw_out, <span class="dt">output =</span> <span class="st">"data.table"</span>)</span></code></pre></div>
<pre><code>##     strategy_id grp_id            iqalys          icosts
##  1:           2      1 0.07 (0.03, 0.14)   67 (-40, 137)
##  2:           2      2 0.04 (0.02, 0.09)   100 (21, 150)
##  3:           2      3 0.03 (0.01, 0.05)   126 (69, 161)
##  4:           2      4 0.02 (0.01, 0.03)  146 (106, 170)
##  5:           2      5 0.01 (0.00, 0.02)  160 (133, 176)
##  6:           2      6 0.11 (0.04, 0.21) -31 (-218, 101)
##  7:           2      7 0.07 (0.03, 0.13)  32 (-105, 125)
##  8:           2      8 0.04 (0.02, 0.08)   81 (-21, 145)
##  9:           2      9 0.02 (0.01, 0.05)   116 (47, 159)
## 10:           2     10 0.01 (0.01, 0.03)   141 (95, 169)
##                      inmb      icer     conclusion
##  1:  3,505 (1,192, 6,752)       938 Cost-effective
##  2:    2,108 (690, 4,223)     2,270 Cost-effective
##  3:    1,192 (352, 2,475)     4,784 Cost-effective
##  4:      614 (140, 1,388)     9,581 Cost-effective
##  5:         268 (-5, 724)    18,658 Cost-effective
##  6: 5,737 (2,115, 10,424) Dominates Cost-effective
##  7:  3,431 (1,229, 6,454)       469 Cost-effective
##  8:    1,950 (677, 3,856)     1,992 Cost-effective
##  9:    1,040 (319, 2,166)     5,020 Cost-effective
## 10:      504 (100, 1,179)    10,921 Cost-effective</code></pre>
</div>
<div id="overall" class="section level2">
<h2 class="hasAnchor">
<a href="#overall" class="anchor"></a><span class="header-section-number">4.2</span> Overall</h2>
<p>Estimates aggregated across all patients can also be computed with <code>$sim_summarize()</code> by using <code>by_grp = FALSE</code>. In this case, overall costs and QALYs are a weighted average (using the column <code>patient_wt</code>) of costs and QALYs for each patient in the input data.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>ce_sim &lt;-<span class="st"> </span>econmod<span class="op">$</span><span class="kw">summarize</span>(<span class="dt">by_grp =</span> <span class="ot">FALSE</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a>icea_pw_out &lt;-<span class="st"> </span><span class="kw"><a href="../reference/icea.html">icea_pw</a></span>(ce_sim, <span class="dt">comparator =</span> <span class="dv">1</span>, <span class="dt">dr_qalys =</span> <span class="fl">.015</span>, <span class="dt">dr_costs =</span> <span class="fl">.06</span>,</span>
<span id="cb24-3"><a href="#cb24-3"></a>                       <span class="dt">k =</span> wtp)</span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="kw"><a href="../reference/icer_tbl.html">icer_tbl</a></span>(icea_pw_out)</span></code></pre></div>
<pre><code>##                   1   2                   
## Incremental QALYs "-" "0.03 (0.01, 0.05)" 
## Incremental costs "-" "118 (53, 159)"     
## Incremental NMB   "-" "1,315 (405, 2,633)"
## ICER              "-" "4,111"             
## Conclusion        "-" "Cost-effective"</code></pre>
</div>
</div>
<div id="appendix-transition-probabilities-from-a-weibull-survival-model" class="section level1">
<h1 class="hasAnchor">
<a href="#appendix-transition-probabilities-from-a-weibull-survival-model" class="anchor"></a><span class="header-section-number">5</span> Appendix: Transition probabilities from a Weibull survival model</h1>
<p>In general, the transition probability of an event given a model cycle is the probability a patient has an event during the cycle conditional on not having an event up until that cycle. That is, given a survivor function, <span class="math inline">\(S(t)\)</span> and a cylce of length <span class="math inline">\(u\)</span>, the transition probability, <span class="math inline">\(tp(t_u)\)</span> of an event is,</p>
<p><span class="math display">\[
\begin{align}
tp(t_u) &amp;= \frac{1 - S(t)}{S(t-u)} \\
&amp;= \frac{1 - exp\{-H(t)\}}{exp\{-H(t-u)\}} \\
&amp;= 1 - exp\{H(t-u) - H(t)\},
\end{align}
\]</span></p>
<p>where <span class="math inline">\(H(t)\)</span> is the cumulative hazard function.</p>
<p>The proportional hazard Weibull distribution with scale parameter <span class="math inline">\(\lambda\)</span> and shape parameter, <span class="math inline">\(\gamma\)</span> has the cumulative hazard function,</p>
<p><span class="math display">\[
H(t) = \lambda t^\gamma
\]</span> The transition probability of an event for the Weibull model is thus,</p>
<p><span class="math display">\[
\begin{align}
tp(t_u) &amp;= 1 - exp\{\lambda (t-u)^\gamma -\lambda t^\gamma\} \\
&amp;= 1 - exp\{\lambda[(t-u)^\gamma  - t^\gamma]\}
\end{align}
\]</span></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview"><span class="toc-section-number">1</span> Overview</a></li>
      <li>
<a href="#define-the-model"><span class="toc-section-number">2</span> Define the model</a><ul class="nav nav-pills nav-stacked">
<li><a href="#data"><span class="toc-section-number">2.1</span> Data</a></li>
      <li><a href="#parameters"><span class="toc-section-number">2.2</span> Parameters</a></li>
      <li><a href="#random-number-generation"><span class="toc-section-number">2.3</span> Random number generation</a></li>
      <li><a href="#transformed-parameters"><span class="toc-section-number">2.4</span> Transformed parameters</a></li>
      <li><a href="#the-model"><span class="toc-section-number">2.5</span> The model</a></li>
      </ul>
</li>
      <li>
<a href="#simulation"><span class="toc-section-number">3</span> Simulation</a><ul class="nav nav-pills nav-stacked">
<li><a href="#health-state-probabilities"><span class="toc-section-number">3.1</span> Health state probabilities</a></li>
      <li><a href="#costs-and-qalys"><span class="toc-section-number">3.2</span> Costs and QALYs</a></li>
      </ul>
</li>
      <li>
<a href="#decision-analysis"><span class="toc-section-number">4</span> Decision analysis</a><ul class="nav nav-pills nav-stacked">
<li><a href="#subgroup-analysis"><span class="toc-section-number">4.1</span> Subgroup analysis</a></li>
      <li><a href="#overall"><span class="toc-section-number">4.2</span> Overall</a></li>
      </ul>
</li>
      <li><a href="#appendix-transition-probabilities-from-a-weibull-survival-model"><span class="toc-section-number">5</span> Appendix: Transition probabilities from a Weibull survival model</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
