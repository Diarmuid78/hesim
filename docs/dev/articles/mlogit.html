<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Markov models with multinomial logistic regression • hesim</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Markov models with multinomial logistic regression">
<meta property="og:description" content="hesim">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hesim</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.3.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">API</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Introduction to hesim</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Markov cohort models</li>
    <li>
      <a href="../articles/getting-started.html">Getting started with a Markov cohort model</a>
    </li>
    <li>
      <a href="../articles/markov-inhomogeneous.html">Time inhomogeneous Markov cohort model</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Statistical models of disease progression</li>
    <li>
      <a href="../articles/mlogit.html">Markov models with multinomial logistic regression</a>
    </li>
    <li>
      <a href="../articles/psm.html">Partitioned survival models</a>
    </li>
    <li>
      <a href="../articles/mstate.html">Markov and semi-Markov multi-state models</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Economic analysis</li>
    <li>
      <a href="../articles/expected-values.html">Simulating costs and quality-adjusted life-years</a>
    </li>
    <li>
      <a href="../articles/icea.html">Individualized cost-effectiveness analysis</a>
    </li>
    <li class="divider">
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hesim-dev/hesim/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Markov models with multinomial logistic regression</h1>
            
            <h4 class="date">2020-05-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hesim-dev/hesim/blob/master/vignettes/mlogit.Rmd"><code>vignettes/mlogit.Rmd</code></a></small>
      <div class="hidden name"><code>mlogit.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>When discrete time data is collected at evenly spaced intervals, cohort discrete time state transition models (cDTSTMs)—often referred to as Markov cohort models—can be parameterized using multinomial logistic regression. Separate multinomial logit model are estimated for each health state and predict the probability of transitioning from that state to all other states. Mathematically, the probability of a transition from state <span class="math inline">\(r\)</span> at model cycle <span class="math inline">\(t\)</span> to state <span class="math inline">\(s\)</span> at model cycle <span class="math inline">\(t+1\)</span> is given by,</p>
<p><span class="math display">\[
Pr(y_{t+1} = s| y_t = r) = \frac{e^{x_r\beta_{rs}}}{\sum_{h=1}^{H}e^{x_r\beta_{rh}}}
\]</span></p>
</div>
<div id="an-example-3-state-model" class="section level1">
<h1 class="hasAnchor">
<a href="#an-example-3-state-model" class="anchor"></a>An example 3-state model</h1>
<p>We illustrate by considering an illness-death model with 3 generic health states: (1) Healthy, (2) Sick, and (3) Dead. We will assume that patients can only transition to a more severe health state:</p>
<ol style="list-style-type: decimal">
<li>Healthy to Sick</li>
<li>Healthy to Dead</li>
<li>Sick to Dead</li>
</ol>
<p><br><img src="illness-death.png" width="500px"><br><br></p>
<p>The transitions of this model can be characterized with a transition matrix with the number of rows and columns equal to the number of health states. In the multinomial logistic regression case, the reference category in each multinomial logit fit is assigned a value of zero. Elements representing transitions that are not possible are <code>NA</code>. All other transitions are represented with integer values from 1 to <span class="math inline">\(K_r -1\)</span> where <span class="math inline">\(K_r\)</span> is the number of states in the multinomial logit model for state <span class="math inline">\(r\)</span>.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">tmat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>),
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">NA</span>, <span class="fl">0</span>, <span class="fl">1</span>),
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">NA</span>, <span class="fl">NA</span>, <span class="fl">NA</span>))
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">tmat</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">tmat</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Healthy"</span>, <span class="st">"Sick"</span>, <span class="st">"Dead"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">tmat</span>)</pre></body></html></div>
<pre><code>##         Healthy Sick Dead
## Healthy       0    1    2
## Sick         NA    0    1
## Dead         NA   NA   NA</code></pre>
<p>The cost-effectiveness analysis will compare two treatment strategies—the “Intervention” and the “Reference” treatment. Separate multinomial logistic regressions are fit for patients starting in the healthy state and the sick state using the <code>multinom3_exdata</code> example dataset, which tracks patient health states at yearly time intervals in a longitudinal fashion.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"hesim"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"data.table"</span>)
<span class="no">transitions_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span>(<span class="no">multinom3_exdata</span>$<span class="no">transitions</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">transitions_data</span>)</pre></body></html></div>
<pre><code>##    patient_id strategy_id strategy_name      age        age_cat female year
## 1:          1           2  Intervention 57.62563 40 &lt;= Age &lt; 60      1    1
## 2:          2           1     Reference 24.63975       Age &lt; 40      1    1
## 3:          3           2  Intervention 37.36108       Age &lt; 40      1    1
## 4:          4           2  Intervention 99.92084      Age &gt;= 60      1    1
## 5:          5           2  Intervention 91.39605      Age &gt;= 60      1    1
## 6:          6           2  Intervention 19.80591       Age &lt; 40      0    1
##    state_from state_to year_cat
## 1:    Healthy  Healthy Year &lt; 3
## 2:    Healthy     Dead Year &lt; 3
## 3:    Healthy  Healthy Year &lt; 3
## 4:    Healthy  Healthy Year &lt; 3
## 5:    Healthy     Sick Year &lt; 3
## 6:    Healthy     Sick Year &lt; 3</code></pre>
<p>In a typical Markov cohort model, either a single cohort or a small number of cohorts is simulated. However, one advantage of using an explicit statistical model to predict transition probabilities is that a large heterogeneous cohort of patients can be easily simulated. Here, we will simulate 100 representative patients (i.e., cohorts), which arguably better captures the underlying heterogeneity in the population. To do so, we will randomly sample 100 patients from the <code>multinom3_exdata</code> dataset. In our data, we observe differences in age and gender.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">n_patients</span> <span class="kw">&lt;-</span> <span class="fl">100</span>
<span class="no">patients</span> <span class="kw">&lt;-</span> <span class="no">transitions_data</span>[<span class="no">year</span> <span class="kw">==</span> <span class="fl">1</span>, <span class="fu">.</span>(<span class="no">patient_id</span>, <span class="no">age</span>, <span class="no">female</span>)][
  <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample.int</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">transitions_data</span>[<span class="no">year</span> <span class="kw">==</span> <span class="fl">1</span>]), <span class="no">n_patients</span>)][
  , <span class="no">grp_id</span> <span class="kw">:=</span> <span class="fl">1</span>:<span class="no">n_patients</span>]
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">patients</span>)</pre></body></html></div>
<pre><code>##    patient_id      age female grp_id
## 1:       9464 81.99775      1      1
## 2:      10000 46.43612      1      2
## 3:       3191 28.77535      1      3
## 4:       6676 56.52093      0      4
## 5:        437 63.23339      1      5
## 6:        107 64.16294      1      6</code></pre>
<p>To perform the cost-effectiveness analysis, each patient is simulated twice, once with the reference treatment and once with the intervention. The non-death states use for simulating costs and quality-adjusted life-years (QALYs) are the healthy and sick states.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">hesim_dat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/hesim_data.html">hesim_data</a></span>(
  <span class="kw">patients</span> <span class="kw">=</span> <span class="no">patients</span>,
  <span class="kw">strategies</span> <span class="kw">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span>(<span class="kw">strategy_id</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">2</span>,
                          <span class="kw">strategy_name</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Reference"</span>, <span class="st">"Intervention"</span>)),
  <span class="kw">states</span> <span class="kw">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span>(<span class="kw">state_id</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>),
                     <span class="kw">state_name</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Healthy"</span>, <span class="st">"Sick"</span>)) <span class="co"># Non-death health states</span>
)</pre></body></html></div>
</div>
<div id="parameter-estimation" class="section level1">
<h1 class="hasAnchor">
<a href="#parameter-estimation" class="anchor"></a>Parameter estimation</h1>
<div id="multinomial-logit-model-for-transition-probabilities" class="section level2">
<h2 class="hasAnchor">
<a href="#multinomial-logit-model-for-transition-probabilities" class="anchor"></a>Multinomial logit model for transition probabilities</h2>
<p><code>hesim</code> can simulate cDTSTMs with transition probabilities fit via multinomial logistic regression with the <code>nnet</code> package. The probability of a health state transition is modeled as a function of the treatment strategy, patient age, and gender. The nonlinear impact of age is modeled using a natural spline with <code><a href="https://rdrr.io/r/splines/ns.html">splines::ns()</a></code>. In addition, time period indicator variables (<code>year_cat</code>) are included so that transition probabilities can change over time, which makes the Markov model time inhomogeneous.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"nnet"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"splines"</span>)

<span class="co"># Transitions from healthy state</span>
<span class="no">data_healthy</span> <span class="kw">&lt;-</span> <span class="no">transitions_data</span>[<span class="no">state_from</span> <span class="kw">==</span> <span class="st">"Healthy"</span>]
<span class="no">fit_healthy</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html">multinom</a></span>(<span class="no">state_to</span> ~ <span class="no">strategy_name</span> + <span class="no">female</span> +
                          <span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span>(<span class="no">age</span>, <span class="kw">df</span> <span class="kw">=</span> <span class="fl">5</span>) + <span class="no">year_cat</span>,
                        <span class="kw">data</span> <span class="kw">=</span> <span class="no">data_healthy</span>, <span class="kw">trace</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="co"># Transitions from sick state</span>
<span class="no">data_sick</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html">droplevels</a></span>(<span class="no">transitions_data</span>[<span class="no">state_from</span> <span class="kw">==</span> <span class="st">"Sick"</span>])
<span class="no">fit_sick</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html">multinom</a></span>(<span class="no">state_to</span> ~ <span class="no">strategy_name</span> + <span class="no">female</span> +
                       <span class="fu"><a href="https://rdrr.io/r/splines/ns.html">ns</a></span>(<span class="no">age</span>, <span class="kw">df</span> <span class="kw">=</span> <span class="fl">5</span>) + <span class="no">year_cat</span>,
                     <span class="kw">data</span> <span class="kw">=</span> <span class="no">data_sick</span>, <span class="kw">trace</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>The separate fits are stored in a list to facilitate prediction of the transition probability matrix.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">transfits</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/multinom_list.html">multinom_list</a></span>(<span class="kw">healthy</span> <span class="kw">=</span> <span class="no">fit_healthy</span>, <span class="kw">sick</span> <span class="kw">=</span> <span class="no">fit_sick</span>)</pre></body></html></div>
</div>
<div id="utility-and-costs" class="section level2">
<h2 class="hasAnchor">
<a href="#utility-and-costs" class="anchor"></a>Utility and costs</h2>
<p>As in the <a href="getting-started.html">“getting started”</a> and <a href="markov-inhomogeneous.html">“time inhomogeneous”</a> vignettes on Markov cohort modeling, utility and costs models could be generated using mathematical expressions with <code><a href="../reference/define_model.html">define_model()</a></code>. However, in this case it is simpler and more direct (and thus more computationally efficient) to use the <code><a href="../reference/stateval_tbl.html">stateval_tbl()</a></code> functionality. Separate tables are created for utility, drug costs, and medical costs.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">utility_tbl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stateval_tbl.html">stateval_tbl</a></span>(<span class="no">multinom3_exdata</span>$<span class="no">utility</span>,
                            <span class="kw">dist</span> <span class="kw">=</span> <span class="st">"beta"</span>,
                            <span class="kw">hesim_data</span> <span class="kw">=</span> <span class="no">hesim_dat</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">utility_tbl</span>)</pre></body></html></div>
<pre><code>##    state_id state_name mean        se
## 1:        1    Healthy 0.90 0.1732051
## 2:        2       Sick 0.65 0.2000000</code></pre>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">drugcost_tbl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stateval_tbl.html">stateval_tbl</a></span>(<span class="no">multinom3_exdata</span>$<span class="no">costs</span>$<span class="no">drugs</span>,
                            <span class="kw">dist</span> <span class="kw">=</span> <span class="st">"fixed"</span>,
                            <span class="kw">hesim_data</span> <span class="kw">=</span> <span class="no">hesim_dat</span>)
<span class="no">medcost_tbl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/stateval_tbl.html">stateval_tbl</a></span>(<span class="no">multinom3_exdata</span>$<span class="no">costs</span>$<span class="no">medical</span>,
                            <span class="kw">dist</span> <span class="kw">=</span> <span class="st">"gamma"</span>,
                            <span class="kw">hesim_data</span> <span class="kw">=</span> <span class="no">hesim_dat</span>)</pre></body></html></div>
</div>
</div>
<div id="simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#simulation" class="anchor"></a>Simulation</h1>
<p>The economic model consists of a model for disease progression and models for assigning utility and cost values to health states. Since we are performing a PSA, we must specify the number of times to sample the parameters.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">n_samples</span> <span class="kw">&lt;-</span> <span class="fl">100</span></pre></body></html></div>
<div id="constructing-the-economic-model" class="section level2">
<h2 class="hasAnchor">
<a href="#constructing-the-economic-model" class="anchor"></a>Constructing the economic model</h2>
<div id="disease-model" class="section level3">
<h3 class="hasAnchor">
<a href="#disease-model" class="anchor"></a>Disease model</h3>
<p>The disease model can be easily constructed from our fitted multinomial logistic regression models and input data. The input data has one observation for each treatment strategy and patient. In addition, since we included time period dummies, we separate the covariates into distinct time intervals in order to make the model time inhomogeneous.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">tintervals</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/time_intervals.html">time_intervals</a></span>(<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">unique</a></span>(<span class="no">transitions_data</span>[, <span class="fu">.</span>(<span class="no">year_cat</span>)])
                             [, <span class="no">time_start</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">6</span>)])
<span class="no">transmod_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/expand.html">expand</a></span>(<span class="no">hesim_dat</span>, <span class="kw">times</span> <span class="kw">=</span> <span class="no">tintervals</span>)
<span class="no">transmod</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_CohortDtstmTrans.html">create_CohortDtstmTrans</a></span>(<span class="no">transfits</span>,
                                    <span class="kw">input_data</span> <span class="kw">=</span> <span class="no">transmod_data</span>,
                                    <span class="kw">trans_mat</span> <span class="kw">=</span> <span class="no">tmat</span>,
                                    <span class="kw">n</span> <span class="kw">=</span> <span class="no">n_samples</span>,
                                    <span class="kw">point_estimate</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
</div>
<div id="utility-and-cost-models" class="section level3">
<h3 class="hasAnchor">
<a href="#utility-and-cost-models" class="anchor"></a>Utility and cost models</h3>
<p>The utility and cost models can be created directly from the utility and cost tables since they do not include covariates. That is, unlike the disease model which explicitly models the transition probabilities as a function of covariates, they are based solely on predicted means (see <code><a href="../reference/tparams_mean.html">tparams_mean()</a></code>) and therefore do not require input data.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co"># Utility</span>
<span class="no">utilitymod</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_StateVals.html">create_StateVals</a></span>(<span class="no">utility_tbl</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="no">n_samples</span>)

<span class="co"># Costs</span>
<span class="no">drugcostmod</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_StateVals.html">create_StateVals</a></span>(<span class="no">drugcost_tbl</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="no">n_samples</span>)
<span class="no">medcostmod</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/create_StateVals.html">create_StateVals</a></span>(<span class="no">medcost_tbl</span>, <span class="kw">n</span> <span class="kw">=</span> <span class="no">n_samples</span>)
<span class="no">costmods</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">Drug</span> <span class="kw">=</span> <span class="no">drugcostmod</span>,
                 <span class="kw">Medical</span> <span class="kw">=</span> <span class="no">medcostmod</span>)</pre></body></html></div>
</div>
<div id="combining-the-disease-progression-cost-and-utility-models" class="section level3">
<h3 class="hasAnchor">
<a href="#combining-the-disease-progression-cost-and-utility-models" class="anchor"></a>Combining the disease progression, cost, and utility models</h3>
<p>The transition, utility, and cost models are combined to create the cDTSTM.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">econmod</span> <span class="kw">&lt;-</span> <span class="no">CohortDtstm</span>$<span class="fu">new</span>(<span class="kw">trans_model</span> <span class="kw">=</span> <span class="no">transmod</span>,
                           <span class="kw">utility_model</span> <span class="kw">=</span> <span class="no">utilitymod</span>,
                           <span class="kw">cost_models</span> <span class="kw">=</span> <span class="no">costmods</span>)</pre></body></html></div>
</div>
</div>
<div id="simulating-outcomes" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-outcomes" class="anchor"></a>Simulating outcomes</h2>
<div id="disease-progression" class="section level3">
<h3 class="hasAnchor">
<a href="#disease-progression" class="anchor"></a>Disease progression</h3>
<p>We simulate state probabilities over 20 years with 1-year model cycles. Means and 95% credible intervals from the PSA are used to summarize the probability of being in each of the 3 states over the model’s time horizon.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">econmod</span>$<span class="fu">sim_stateprobs</span>(<span class="kw">n_cycles</span> <span class="kw">=</span> <span class="fl">20</span>)

<span class="co"># Plot</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"ggplot2"</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>())
<span class="no">stateprob_summary</span> <span class="kw">&lt;-</span> <span class="no">econmod</span>$<span class="no">stateprobs_</span>[, <span class="fu">.</span>(<span class="kw">prob_mean</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">prob</span>),
                                              <span class="kw">prob_lower</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">prob</span>, <span class="fl">.025</span>),
                                              <span class="kw">prob_upper</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="no">prob</span>, <span class="fl">.975</span>)),
                                          <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"strategy_id"</span>, <span class="st">"state_id"</span>, <span class="st">"t"</span>)]
<span class="no">stateprob_summary</span>[, <span class="no">strategy_name</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">strategy_id</span>,
                                          <span class="kw">labels</span> <span class="kw">=</span> <span class="no">hesim_dat</span>$<span class="no">strategies</span>$<span class="no">strategy_name</span>)]
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">stateprob_summary</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">t</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">prob_mean</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">col</span> <span class="kw">=</span> <span class="no">strategy_name</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">geom_ribbon</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">t</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">prob_lower</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">prob_upper</span>,
                  <span class="kw">fill</span> <span class="kw">=</span> <span class="no">strategy_name</span>), <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">.3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">state_id</span>, <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">hesim_dat</span>$<span class="no">states</span>$<span class="no">state_name</span>, <span class="st">"Death"</span>))) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Year"</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Probability"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_hue.html">scale_fill_discrete</a></span>(<span class="st">"Strategy"</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_hue.html">scale_color_discrete</a></span>(<span class="st">"Strategy"</span>)</pre></body></html></div>
<p><img src="mlogit_files/figure-html/stateprobs-1.png" width="672"></p>
</div>
<div id="costs-and-qalys" class="section level3">
<h3 class="hasAnchor">
<a href="#costs-and-qalys" class="anchor"></a>Costs and QALYs</h3>
<p>After simulating the health state transitions, costs and QALYs are simulated in a straightforward manner. As is typical, we use a 3 percent discount rate.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">econmod</span>$<span class="fu"><a href="../reference/sim_ev.html">sim_qalys</a></span>(<span class="kw">dr</span> <span class="kw">=</span> <span class="fl">.03</span>)
<span class="no">econmod</span>$<span class="fu"><a href="../reference/sim_ev.html">sim_costs</a></span>(<span class="kw">dr</span> <span class="kw">=</span> <span class="fl">.03</span>)</pre></body></html></div>
</div>
</div>
</div>
<div id="decision-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#decision-analysis" class="anchor"></a>Decision analysis</h1>
<p>Now that costs and QALYs have been simulated with the PSA, a decision analysis can be performed. We will focus on the pairwise comparison between the “Intervention” and the “Reference” treatment.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">ce_sim</span> <span class="kw">&lt;-</span> <span class="no">econmod</span>$<span class="fu">summarize</span>(<span class="kw">by_grp</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">icea_pw_out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/icea.html">icea_pw</a></span>(<span class="no">ce_sim</span>, <span class="kw">comparator</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">dr_qalys</span> <span class="kw">=</span> <span class="fl">.03</span>, <span class="kw">dr_costs</span> <span class="kw">=</span> <span class="fl">.03</span>)</pre></body></html></div>
<p>Since we modeled the health state transitions as a function of covariates, transition rates vary by patient characteristics. The impact of gender and the (nonlinear) impact of age on transitions have a similar effect on the incremental cost-effectiveness ratio (ICER). The ICERs were lower for females and tended to rise with age, suggesting that the “Intervention” was more effective for patients with a lower baseline risk.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">icers</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span>(<span class="no">icea_pw_out</span>$<span class="no">summary</span>,
               <span class="no">hesim_dat</span>$<span class="no">patients</span>[, <span class="fu">.</span>(<span class="no">grp_id</span>, <span class="no">age</span>, <span class="no">female</span>)],
               <span class="kw">by</span> <span class="kw">=</span> <span class="st">"grp_id"</span>)
<span class="no">icers</span>[, <span class="no">gender</span> <span class="kw">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">female</span>,
                         <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>),
                         <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>))]

<span class="co"># Plot of ICER by demographics</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">icers</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">age</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">","</span>, <span class="st">""</span>, <span class="no">icer</span>)), <span class="kw">col</span> <span class="kw">=</span> <span class="no">gender</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span>(<span class="st">"Age"</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span>(<span class="st">"Incremental cost-effectiveness ratio"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="kw">label</span> <span class="kw">=</span> <span class="kw pkg">scales</span><span class="kw ns">::</span><span class="fu"><a href="https://scales.r-lib.org//reference/label_dollar.html">dollar_format</a></span>()) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_hue.html">scale_colour_discrete</a></span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">""</span>)</pre></body></html></div>
<p><img src="mlogit_files/figure-html/icerHeterogeneity-1.png" width="672"></p>
<p>Of note, the heterogeneous ICER arises completely through differences in baseline risk since the effect of the “Intervention” relative to the “Reference” on transitions was assumed to be constant across patients (i.e., the treatment strategy covariate did not have any effect modifiers). This example highlights an advantage of modeling disease progression with a statistical model in that it can facilitate analyses that assess the consequences of patient heterogeneity.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Devin Incerti, Jeroen P. Jansen.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
